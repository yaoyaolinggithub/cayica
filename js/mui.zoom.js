(function(c,e){var i=c.className("zoom");var h=c.className("zoom-scroller");var g="."+i;var f="."+h;var a="pinchstart";var b="pinch";var d="pinchend";if("ongesturestart" in e){a="gesturestart";b="gesturechange";d="gestureend"}c.Zoom=function(p,r){var l=this;l.options=c.extend(c.Zoom.defaults,r);l.wrapper=l.element=p;l.scroller=p.querySelector(f);l.scrollerStyle=l.scroller&&l.scroller.style;l.zoomer=p.querySelector(g);l.zoomerStyle=l.zoomer&&l.zoomer.style;l.init=function(){c.options.gestureConfig.pinch=true;c.options.gestureConfig.doubletap=true;l.initEvents()};l.initEvents=function(N){var L=N?"removeEventListener":"addEventListener";var M=l.scroller;M[L](a,l.onPinchstart);M[L](b,l.onPinch);M[L](d,l.onPinchend);M[L](c.EVENT_START,l.onTouchstart);M[L](c.EVENT_MOVE,l.onTouchMove);M[L](c.EVENT_CANCEL,l.onTouchEnd);M[L](c.EVENT_END,l.onTouchEnd);M[L]("drag",l.dragEvent);M[L]("doubletap",l.doubleTapEvent)};l.dragEvent=function(L){if(y||s){L.stopPropagation()}};l.doubleTapEvent=function(L){l.toggleZoom(L.detail.center)};l.transition=function(L,M){M=M||0;L.webkitTransitionDuration=M+"ms";return l};l.translate=function(M,L,N){L=L||0;N=N||0;M.webkitTransform="translate3d("+L+"px,"+N+"px,0px)";return l};l.scale=function(L,M){M=M||1;L.webkitTransform="translate3d(0,0,0) scale("+M+")";return l};l.scrollerTransition=function(L){return l.transition(l.scrollerStyle,L)};l.scrollerTransform=function(L,M){return l.translate(l.scrollerStyle,L,M)};l.zoomerTransition=function(L){return l.transition(l.zoomerStyle,L)};l.zoomerTransform=function(L){return l.scale(l.zoomerStyle,L)};var J=1,F=1,v=false,s=false;l.onPinchstart=function(L){s=true};l.onPinch=function(L){if(!v){l.zoomerTransition(0);v=true}J=(L.detail?L.detail.scale:L.scale)*F;if(J>l.options.maxZoom){J=l.options.maxZoom-1+Math.pow((J-l.options.maxZoom+1),0.5)}if(J<l.options.minZoom){J=l.options.minZoom+1-Math.pow((l.options.minZoom-J+1),0.5)}l.zoomerTransform(J)};l.onPinchend=function(L){J=Math.max(Math.min(J,l.options.maxZoom),l.options.minZoom);l.zoomerTransition(l.options.speed).zoomerTransform(J);F=J;v=false};l.setZoom=function(L){J=F=L;l.scrollerTransition(l.options.speed).scrollerTransform(0,0);l.zoomerTransition(l.options.speed).zoomerTransform(J)};l.toggleZoom=function(M,N){if(typeof M==="number"){N=M;M=undefined}N=typeof N==="undefined"?l.options.speed:N;if(J&&J!==1){J=F=1;l.scrollerTransition(N).scrollerTransform(0,0)}else{J=F=l.options.maxZoom;if(M){var Q=c.offset(l.zoomer);var P=Q.top;var O=Q.left;var L=(M.x-O)*J;var R=(M.y-P)*J;this._cal();if(L>=D&&L<=(D+q)){L=D-L+q/2}else{if(L<D){L=D-L+q/2}else{if(L>(D+q)){L=D+q-L-q/2}}}if(R>=B&&R<=(B+G)){R=B-R+G/2}else{if(R<B){R=B-R+G/2}else{if(R>(B+G)){R=B+G-R-G/2}}}L=Math.min(Math.max(L,E),D);R=Math.min(Math.max(R,C),B);l.scrollerTransition(N).scrollerTransform(L,R)}else{l.scrollerTransition(N).scrollerTransform(0,0)}}l.zoomerTransition(N).zoomerTransform(J)};l._cal=function(){q=l.wrapper.offsetWidth;G=l.wrapper.offsetHeight;u=l.zoomer.offsetWidth;I=l.zoomer.offsetHeight;var L=u*J;var M=I*J;E=Math.min((q/2-L/2),0);D=-E;C=Math.min((G/2-M/2),0);B=-C};var q,G,H,y,o,m,E,C,D,B,u,I,A={},t={},x,w,j,z,n,K,k;l.onTouchstart=function(L){L.preventDefault();H=true;A.x=L.type===c.EVENT_START?L.targetTouches[0].pageX:L.pageX;A.y=L.type===c.EVENT_START?L.targetTouches[0].pageY:L.pageY};l.onTouchMove=function(N){N.preventDefault();if(!H){return}if(!y){q=l.wrapper.offsetWidth;G=l.wrapper.offsetHeight;u=l.zoomer.offsetWidth;I=l.zoomer.offsetHeight;var O=c.parseTranslateMatrix(c.getStyles(l.scroller,"webkitTransform"));x=O.x||0;w=O.y||0;l.scrollerTransition(0)}var L=u*J;var M=I*J;if(L<q&&M<G){return}E=Math.min((q/2-L/2),0);D=-E;C=Math.min((G/2-M/2),0);B=-C;t.x=N.type===c.EVENT_MOVE?N.targetTouches[0].pageX:N.pageX;t.y=N.type===c.EVENT_MOVE?N.targetTouches[0].pageY:N.pageY;if(!y&&!v){if((Math.floor(E)===Math.floor(x)&&t.x<A.x)||(Math.floor(D)===Math.floor(x)&&t.x>A.x)){H=false;return}}y=true;o=t.x-A.x+x;m=t.y-A.y+w;if(o<E){o=E+1-Math.pow((E-o+1),0.8)}if(o>D){o=D-1+Math.pow((o-D+1),0.8)}if(m<C){m=C+1-Math.pow((C-m+1),0.8)}if(m>B){m=B-1+Math.pow((m-B+1),0.8)}if(!j){j=t.x}if(!K){K=t.y}if(!z){z=c.now()}n=(t.x-j)/(c.now()-z)/2;k=(t.y-K)/(c.now()-z)/2;if(Math.abs(t.x-j)<2){n=0}if(Math.abs(t.y-K)<2){k=0}j=t.x;K=t.y;z=c.now();l.scrollerTransform(o,m)};l.onTouchEnd=function(S){if(!S.touches.length){s=false}if(!H||!y){H=false;y=false;return}H=false;y=false;var U=300;var T=300;var M=n*U;var P=o+M;var L=k*T;var O=m+L;if(n!==0){U=Math.abs((P-o)/n)}if(k!==0){T=Math.abs((O-m)/k)}var Q=Math.max(U,T);o=P;m=O;var N=u*J;var R=I*J;E=Math.min((q/2-N/2),0);D=-E;C=Math.min((G/2-R/2),0);B=-C;o=Math.max(Math.min(o,D),E);m=Math.max(Math.min(m,B),C);l.scrollerTransition(Q).scrollerTransform(o,m)};l.destroy=function(){l.initEvents(true);delete c.data[l.wrapper.getAttribute("data-zoomer")];l.wrapper.setAttribute("data-zoomer","")};l.init();return l};c.Zoom.defaults={speed:300,maxZoom:3,minZoom:1,};c.fn.zoom=function(k){var j=[];this.each(function(){var m=null;var l=this;var n=l.getAttribute("data-zoomer");if(!n){n=++c.uuid;c.data[n]=m=new c.Zoom(l,k);l.setAttribute("data-zoomer",n)}else{m=c.data[n]}j.push(m)});return j.length===1?j[0]:j}})(mui,window);