var ui={btnSure:sui.gel("btnSure"),container:sui.gel("container"),w:null,txtTotal:sui.gel("txtTotal"),txtName:sui.gel("txtName"),txtMobile:sui.gel("txtMobile"),address:sui.gel("address"),detailAddr:sui.gel("detailAddr"),txtTime:sui.gel("txtTime"),yjFee:sui.gel("yjFee"),zjFee:sui.gel("zjFee"),bjFee:sui.gel("bjFee"),yajinPrice:0,zujinPrice:0,imgIdArr:[],detail:[],channel:2,qhdate:"",qhTime:"",recoverExplain:sui.gel("recoverExplain"),scontent:sui.gel("scontent"),areaPicker:null,provice:null,city:null,district:null,road:null};var template=function(e){ui.yajinPrice+=(+e.NowDeposit);ui.zujinPrice+=(+e.Rent);ui.imgIdArr.push({id:e.unique,imgurl:e.CoverImage});var f='<span class="guige">产品型号：'+e.StockCode+" </span>";if(!sui.IsNullOrEmpty(e.SkuAttribute)){var d=JSON.parse(e.SkuAttribute);var a=d.length;for(var c=0;c<a;c++){if(c==2){break}f+='<span class="guige">'+d[c].AttrName+"："+d[c].AttrVal+" </span>"}}var b=['<li class="mui-table-view-cell color" data="detail" data-v="'+e.ProductSkuId+'"><div class="g-box"><img src="../images/hand.png"  id="'+e.unique+'"/>','<div class="order_tit"><div class="mui-ellipsis-2 tit" >'+e.SkuName+"</div>",'<div class="top12">'+f+"</div></div>",'</div><div class="p-box"><span class="price" >押金：￥'+sui.rmoney(e.NowDeposit)+"</span>",'<span class="price" >租金：￥'+sui.rmoney(e.Rent)+'</span><span class="price" >租期：'+e.Periods+"</span></div></li>"].join("");return b};(function(a){if(a.os.ios){ui.scontent.classList.add("ios-scroll-bounce")}a.plusReady(function(){ui.areaPicker=new a.PopPicker({layer:4});ui.channel=plus.os.name=="Android"?2:3;setTimeout(function(){ui.w=sui.wait("正在加载...");var q=plus.webview.currentWebview();var l=JSON.parse(q.result||"[]");var k=l.length;var n="";for(var o=0;o<k;o++){var j={OrderId:l[o].OrderId,ProductSkuId:l[o].ProductSkuId,StockDetailId:l[o].StockDetailId,Num:1};ui.detail.push(j);n+=template(l[o])}ui.container.innerHTML=n;var p=ui.imgIdArr.length;for(var h=0;h<p;h++){cache.setImg(ui.imgIdArr[h].id,ui.imgIdArr[h].imgurl)}ui.txtTotal.value=k;ui.yjFee.innerText="￥"+sui.rmoney(ui.yajinPrice);ui.zjFee.innerText="￥"+sui.rmoney(ui.zujinPrice);ui.bjFee.innerHTML=ui.yajinPrice-ui.zujinPrice>0?'应退还押金<span class="mui-pull-right">￥'+sui.rmoney(ui.yajinPrice-ui.zujinPrice)+"</span>":'应补交租金<span class="mui-pull-right">￥'+sui.rmoney(Math.abs(ui.yajinPrice-ui.zujinPrice))+"</span>";sui.request("Passport/GetArea",{},true,function(r){if(r){var m=r.IsPass;if(m){ui.areaPicker.setData(r.ReturnList);var i=document.querySelector(".mui-poppicker-body");if(a.os.ios&&parseFloat(a.os.version)>8&&i){i.classList.add("ios-poppicker")}sui.closewait(ui.w)}else{a.toast(r.Desc);sui.closewait(ui.w)}}else{mui.toast("无法连接到服务器，请检查网络是否连接");sui.closewait(ui.w)}})},250);ui.address.addEventListener("tap",function(){ui.txtName.blur();ui.txtMobile.blur();ui.detailAddr.blur();setTimeout(function(){if(ui.provice&&ui.provice!="undefined"){ui.areaPicker.pickers[0].setSelectedValue(ui.provice)}if(ui.city&&ui.city!="undefined"){setTimeout(function(){ui.areaPicker.pickers[1].setSelectedValue(ui.city)},100)}if(ui.district&&ui.district!="undefined"){setTimeout(function(){ui.areaPicker.pickers[2].setSelectedValue(ui.district)},200)}if(ui.road&&ui.road!="undefined"){setTimeout(function(){ui.areaPicker.pickers[3].setSelectedValue(ui.road)},300)}ui.areaPicker.show(function(h){ui.provice=h[0].value;ui.city=h[1].value;ui.district=h[2].value;ui.road=h[3].value;if(h[1]&&h[2]&&h[3]&&ui.provice!=undefined&&ui.provice!="undefined"&&ui.city!=undefined&&ui.city!="undefined"&&ui.district!=undefined&&ui.district!="undefined"&&ui.road!=undefined&&ui.road!="undefined"){ui.address.value=h[0].text+h[1].text+h[2].text+h[3].text;ui.address.setAttribute("data",h[3].value)}else{if(h[1]&&h[2]&&ui.provice!=undefined&&ui.provice!="undefined"&&ui.city!=undefined&&ui.city!="undefined"&&ui.district!=undefined&&ui.district!="undefined"){ui.address.value=h[0].text+h[1].text+h[2].text;ui.address.setAttribute("data",h[2].value)}else{if(h[1]&&ui.provice!=undefined&&ui.provice!="undefined"&&ui.city!=undefined&&ui.city!="undefined"){ui.address.value=h[0].text+h[1].text;ui.address.setAttribute("data",h[1].value)}else{if(ui.provice!=undefined&&ui.provice!="undefined"){ui.address.value=h[0].text;ui.address.setAttribute("data",h[0].value)}}}}})},0)},false);var d=new Date();var g=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate();var f=[{text:"8:00-9:00",value:"8:00-9:00"},{text:"9:00-10:00",value:"9:00-10:00"},{text:"10:00-11:00",value:"10:00-11:00"},{text:"11:00-12:00",value:"11:00-12:00"},{text:"12:00-13:00",value:"12:00-13:00"},{text:"13:00-14:00",value:"13:00-14:00"},{text:"14:00-15:00",value:"14:00-15:00"},{text:"15:00-16:00",value:"15:00-16:00"},{text:"16:00-17:00",value:"16:00-17:00"},{text:"17:00-18:00",value:"17:00-18:00"},{text:"18:00-19:00",value:"18:00-19:00"},{text:"19:00-20:00",value:"19:00-20:00"},{text:"20:00-21:00",value:"20:00-21:00"},{text:"21:00-22:00",value:"21:00-22:00"}];var c={type:"hour",value:sui.formatDate("y-m-d",g),beginYear:d.getFullYear(),endYear:2020,customData:{h:f},labels:["年","月","日","时段","分"]};var b=new a.DtPicker(c);var e=document.querySelector(".mui-dtpicker-body");if(a.os.ios&&parseFloat(a.os.version)>8&&e){e.classList.add("ios-poppicker")}ui.txtTime.addEventListener("tap",function(){ui.txtName.blur();ui.txtMobile.blur();ui.detailAddr.blur();setTimeout(function(){b.show(function(h){ui.txtTime.value=h.text;ui.qhdate=h.y.text+"-"+h.m.text+"-"+h.d.text;ui.qhTime=h.h.text})},false)},0);ui.btnSure.addEventListener("tap",function(){var i={UserId:"00000000-0000-0000-0000-000000000000",ContactPerson:ui.txtName.value.trim(),ContactPhone:ui.txtMobile.value.trim(),QuHuoAreaCode:ui.address.getAttribute("data").trim(),QuHuoAreaName:ui.address.value.trim(),QuHuoAddress:ui.detailAddr.value.trim(),QuHuoDate:ui.qhdate,QuHuoTime:ui.qhTime,Source:ui.channel};if(sui.IsNullOrEmpty(i.ContactPerson)){a.toast("请输入您的姓名");return}else{if(sui.IsNullOrEmpty(i.ContactPhone)){a.toast("请输入您的手机号");return}else{if(!i.ContactPhone.isMobile()){a.toast("请输入正确的手机号");return}else{if(sui.IsNullOrEmpty(i.QuHuoAreaCode)){a.toast("请选择您所在地区");return}else{if(sui.IsNullOrEmpty(i.QuHuoAddress)){a.toast("请输入您的详细地址");return}else{if(sui.IsNullOrEmpty(i.QuHuoTime)){a.toast("请选择归还时间");return}else{if(ui.detail.length==0){a.toast("数据异常");return}}}}}}}ui.w=sui.wait("请稍候...");var h={myRestore:i,productDetail:ui.detail};sui.post("Order/Restore",h,function(m){if(m){var l=m.IsPass;if(l){var j={RecycleId:m.ReturnDataTable[0].RecycleId,BuJiaoRent:m.ReturnDataTable[0].BuJiaoRent,PayTitle:m.ReturnDataTable[0].PayTitle,PayWaterId:m.ReturnDataTable[0].PayWaterId};if(j.BuJiaoRent>0){sui.open("orderPay.html","orderPay.html",{PayWaterId:j.PayWaterId,Amount:j.BuJiaoRent,PayTitle:j.PayTitle,payType:2});setTimeout(function(){var n=plus.webview.currentWebview();n.close("none",0)},500)}else{var k=plus.webview.getWebviewById("recover.html");if(k){k.evalJS("pulldownRefresh();")}sui.open("recoverDetail.html","recoverDetail.html",{RecycleId:j.RecycleId});setTimeout(function(){var n=plus.webview.currentWebview();n.close("none",0)},500)}sui.closewait(ui.w)}else{a.toast(m.Desc);sui.closewait(ui.w)}}else{a.toast("无法连接到服务器，请检查网络是否连接！");sui.closewait(ui.w)}})})})})(mui);ui.recoverExplain.addEventListener("tap",function(){sui.open("../help/zuxieyiMain.html","zuxieyiMain.html",{})});