var ui={item1mobile:sui.gel("item1mobile"),item2mobile:sui.gel("item2mobile"),item3mobile:sui.gel("item3mobile"),type:0,index1:1,index2:1,index3:1,w:null,elem:null,container:null,index:1,Arr:sui.gel("sliderSegmentedControl").querySelectorAll("a"),panelTitle1:sui.gel("panelTitle1"),panelTitle2:sui.gel("panelTitle2"),panelTitle3:sui.gel("panelTitle3"),loopPullDown:null};var disabledTap=function(){mui.each(ui.Arr,function(a,b){b.classList.add("mui-disabled")})};var recoverTap=function(){mui.each(ui.Arr,function(a,b){b.classList.remove("mui-disabled")})};var template=function(c,e,d,g,f,h,a,b){var j={fontsize:"",len:e.toString().length,badge:"",border:"",primary:"main"};if(j.len>=3&&j.len<5){j.fontsize="font-size3"}if(j.len>=5){j.fontsize="font-size5"}switch(b){case 0:j.badge=a==1?'<a class="mui-badge">即将过期</a>':"";j.border=c==0?"border":"";j.primary=(c==0?"main ":"primary ")+j.fontsize;break;case 1:j.badge='<a class="mui-badge">已使用</a>';j.border="border2";j.primary="gray "+j.fontsize;break;case 2:j.badge='<a class="mui-badge">已过期</a>';j.border="border2";j.primary="gray "+j.fontsize;break;default:break}j.badge=b==0?(a==1?'<a class="mui-badge">即将过期</a>':""):"";var i=['<div class="desc '+j.border+'"><div class="box">','<span class="mui-badge-circle">'+(c==0?"押":"租")+'</span><span class="quandesc">','<span class="mui-ellipsis">'+d+j.badge+"</span>",'<span class="mui-ellipsis">满'+g+"可用"+h+"</span>",'</span></div><div class="date"> 有效日期：'+f+"</div>",'</div><ul class="quan" ><li class="'+j.primary+'"><span class="sign">￥</span>'+e+"</li></ul>"].join("");return i};(function(a){a.init({pullRefresh:{container:"#pullrefresh",down:{callback:pulldownRefresh},up:{callback:pullupRefresh}}});a.plusReady(function(){ui.type=0;ui.container=ui.item1mobile;ui.index=ui.index1;setTimeout(function(){a("#pullrefresh").pullRefresh().pullupLoading()},180)})})(mui);function pulldownRefresh(){disabledTap();var a={container:ui.container,type:ui.type};clearTimeout(ui.loopPullDown);setTimeout(function(){sui.request("Fund/GetQuanList",{quanState:a.type,pageIndex:1},true,function(g){if(g){var f=g.IsPass;if(f){ui.panelTitle1.innerText="未使用("+g.Two[0].NoUse+")";ui.panelTitle2.innerText="已过期("+g.Two[0].GuoQi+")";ui.panelTitle3.innerText="已使用("+g.Two[0].Used+")";var e=g.One.length;a.container.innerHTML="";if(e>0){ui.elem=sui.rtips(ui.elem);var c=sui.fragment();for(var d=0;d<e;d++){var b={MyQuanId:g.One[d].MyQuanId,Name:g.One[d].Name,Amount:g.One[d].Amount.toFixed(0),MinCharge:g.One[d].MinCharge.toFixed(0),QuanType:g.One[d].QuanType,ValidTerm:g.One[d].ValidTerm,Category:g.One[d].Category,RemindExpire:g.One[d].RemindExpire};var h=document.createElement("div");h.className="quan-box";h.setAttribute("data",b.MyQuanId);h.innerHTML=template(b.QuanType,b.Amount,b.Name,b.MinCharge,b.ValidTerm,b.Category,b.RemindExpire,a.type);c.appendChild(h)}a.container.appendChild(c);switch(a.type){case 0:ui.index1=2;ui.index=ui.index1;break;case 1:ui.index3=2;ui.index=ui.index3;break;case 2:ui.index2=2;ui.index=ui.index2;break;default:break}mui("#pullrefresh").pullRefresh().endPulldownToRefresh();ui.loopPullDown=setTimeout(function(){mui("#pullrefresh").pullRefresh().enablePullupToRefresh();mui("#pullrefresh").pullRefresh().refresh(true)},1000)}else{switch(a.type){case 0:ui.index1=1;ui.index=ui.index1;break;case 1:ui.index3=1;ui.index=ui.index3;break;case 2:ui.index2=1;ui.index=ui.index2;break;default:break}mui("#pullrefresh").pullRefresh().endPulldownToRefresh();mui("#pullrefresh").pullRefresh().disablePullupToRefresh();if(!ui.elem){ui.elem=sui.ctips("comiiszanwushuju","暂无相关数据")}}}else{mui("#pullrefresh").pullRefresh().endPulldownToRefresh();mui.toast(g.Desc)}recoverTap()}else{mui("#pullrefresh").pullRefresh().endPulldownToRefresh();mui.toast("无法连接到服务器，请检查网络是否连接！");recoverTap()}})},400)}function pullupRefresh(){disabledTap();var a={container:ui.container,index:ui.index,type:ui.type};ui.loadfirst=false;setTimeout(function(){sui.request("Fund/GetQuanList",{quanState:a.type,pageIndex:a.index},true,function(g){if(g){var f=g.IsPass;if(f){ui.panelTitle1.innerText="未使用("+g.Two[0].NoUse+")";ui.panelTitle2.innerText="已过期("+g.Two[0].GuoQi+")";ui.panelTitle3.innerText="已使用("+g.Two[0].Used+")";var e=g.One.length;if(e>0){var c=sui.fragment();for(var d=0;d<e;d++){var b={MyQuanId:g.One[d].MyQuanId,Name:g.One[d].Name,Amount:g.One[d].Amount.toFixed(0),MinCharge:g.One[d].MinCharge.toFixed(0),QuanType:g.One[d].QuanType,ValidTerm:g.One[d].ValidTerm,Category:g.One[d].Category,RemindExpire:g.One[d].RemindExpire};var h=document.createElement("div");h.className="quan-box";h.setAttribute("data",b.MyQuanId);h.innerHTML=template(b.QuanType,b.Amount,b.Name,b.MinCharge,b.ValidTerm,b.Category,b.RemindExpire,a.type);c.appendChild(h)}a.container.appendChild(c);switch(a.type){case 0:ui.index1++;ui.index=ui.index1;break;case 1:ui.index3++;ui.index=ui.index3;break;case 2:ui.index2++;ui.index=ui.index2;break;default:break}mui("#pullrefresh").pullRefresh().endPullupToRefresh(false)}else{if(ui.index==1){mui("#pullrefresh").pullRefresh().endPullupToRefresh(true);mui("#pullrefresh").pullRefresh().disablePullupToRefresh();if(!ui.elem){ui.elem=sui.ctips("comiiszanwushuju","暂无相关数据")}}else{mui("#pullrefresh").pullRefresh().endPullupToRefresh(true)}}}else{mui.toast(g.Desc);mui("#pullrefresh").pullRefresh().endPullupToRefresh(false)}recoverTap()}else{mui.toast("无法连接到服务器，请检查网络是否连接！");mui("#pullrefresh").pullRefresh().endPullupToRefresh(false);recoverTap()}})},400)}mui("#sliderSegmentedControl").on("tap","a[data=tap]",function(){var b=this;if(~b.className.indexOf("mui-active")){mui("#pullrefresh").pullRefresh().scrollTo(0,0,200);return}var a=b.id;ui.elem=sui.rtips(ui.elem);if(mui.os.ios){mui("#pullrefresh").pullRefresh().scrollTo(0,0,0)}else{mui("#pullrefresh").pullRefresh().scrollTo(0,0,100)}if(a=="panelTitle1"){ui.type=0;ui.container=ui.item1mobile;ui.index=ui.index1}else{if(a=="panelTitle2"){ui.type=2;ui.container=ui.item2mobile;ui.index=ui.index2}else{if(a=="panelTitle3"){ui.type=1;ui.container=ui.item3mobile;ui.index=ui.index3}}}if(ui.index==1){mui("#pullrefresh").pullRefresh().disablePullupToRefresh();setTimeout(function(){mui("#pullrefresh").pullRefresh().pulldownLoading()},100)}else{mui("#pullrefresh").pullRefresh().enablePullupToRefresh()}});mui("#container").on("tap","div[class=quan-box]",function(){var b=this.getAttribute("data");var a=[{title:"删除",style:"destructive"}];plus.nativeUI.actionSheet({cancel:"取消",buttons:a},function(c){if(c.index==1){ui.w=sui.wait("请稍候...");sui.post("Fund/DeleteMyQuan",{myQuanId:b},function(e){if(e){var d=e.IsPass;if(d){pulldownRefresh();var f=plus.webview.getWebviewById("my.html");if(f){mui.fire(f,"mycenter")}mui.toast("删除成功")}else{mui.toast(e.Desc)}sui.closewait(ui.w)}else{mui.toast("无法连接到服务器，请检查网络是否连接");sui.closewait(ui.w)}})}})});