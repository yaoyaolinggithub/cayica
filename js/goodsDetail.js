var ui={addCart:sui.gel("addCart"),navbox:sui.gel("navbox"),cartNum:sui.gel("cartNum"),SmallImage:sui.gel("SmallImage"),w:null,imgIdArr:[],productSkuId:null,Description:"",sliderbox:sui.gel("sliderbox"),indicator:sui.gel("indicator"),container:sui.gel("container"),MobileWebUrl:"",shares:{},title:"",content:"",carts:sui.gel("carts"),schemeId:null,isScheme:false,ProductType:0,isRefresh:true,msgNum:sui.gel("msgNum"),MessageCount:0,arerId:"",ShouHuoAddressList:null,navtip:sui.gel("navtip"),areaCode:null};function downloadQueue(){if(ui.imgIdArr.length>0){var a=ui.imgIdArr.shift();cache.setImg(a.id,a.imgurl,downloadQueue)}}(function(a){if(a.os.ios){document.getElementById("safari").classList.remove("mui-hidden")}a.init({pullRefresh:{container:"#pullrefresh",up:{callback:pullupRefresh,contentinit:"",contentdown:"",contentnomore:""},parallaxRatio:0.5,parallaxElement:"#slider"}});a.plusReady(function(){ui.productSkuId=plus.webview.currentWebview().pid;setTimeout(function(){ui.w=sui.wait("正在加载...");refreshDetail();plus.share.getServices(function(d){if(d&&d.length>0){for(var c=0;c<d.length;c++){var b=d[c];ui.shares[b.id]=b}}},function(){a.toast("获取分享服务列表失败")})},250)})})(mui);function pullupRefresh(){setTimeout(function(){var a=document.querySelector(".img-box");if(a){a.innerHTML=ui.Description}mui("#pullrefresh").pullRefresh().endPullupToRefresh(true);mui("#pullrefresh").pullRefresh().disablePullupToRefresh()},200)}var refreshDetail=function(){ui.areaCode=localStorage.getItem("areaCode_cayica")||"";var a=localStorage.getItem("longitude_cayica")||0;var b=localStorage.getItem("latitude_cayica")||0;sui.request("Home/ProductDetail",{productSkuId:ui.productSkuId,areaCode:ui.areaCode,longitude:a,latitude:b},true,function(o){if(o){var r=o.IsPass;if(r){ui.areaCode=o.ReturnObject.DeliveryAreaCode;ui.imgIdArr=[];ui.productSkuId=o.ReturnObject.ProductSkuId;ui.Description=o.ReturnObject.Description;ui.MobileWebUrl=o.ReturnObject.MobileWebUrl;ui.title=o.ReturnObject.ProductName;ui.MessageCount=o.ReturnObject.MessageCount;var w={ShoppingCarCount:o.ReturnObject.ShoppingCarCount,ImageList:o.ReturnObject.ImageList,RentTitle:o.ReturnObject.RentTitle,OldRent:o.ReturnObject.OldRent,NowRent:o.ReturnObject.NowRent,Deposit:o.ReturnObject.Deposit,DinJin:o.ReturnObject.DinJin,SaleType:o.ReturnObject.SaleType,Promise:o.ReturnObject.Promise,AttributeList:o.ReturnObject.AttributeList,HasCoupon:o.ReturnObject.HasCoupon,HasRule:o.ReturnObject.HasRule,IsGroup:o.ReturnObject.IsGroup,GroupProductList:o.ReturnObject.GroupProductList,SaleTypeTitle:o.ReturnObject.SaleTypeTitle,HasRent:o.ReturnObject.HasRent,SmallImage:o.ReturnObject.SmallImage,ProductFlag:o.ReturnObject.ProductFlag,DeliveryAddress:o.ReturnObject.DeliveryAddress};localStorage.setItem("OnlineAreaList_cayica",JSON.stringify(o.ReturnObject.OnlineAreaList||[]).replace(/\"/ig,"'"));ui.ShouHuoAddressList=JSON.stringify(o.ReturnObject.ShouHuoAddressList||[]).replace(/\"/ig,"'");var u={banner:[],indicator:[],banlast:sui.unique(6),banfirst:sui.unique(6),sbHtml:[],bLen:w.ImageList.length,groupLen:w.GroupProductList.length,attrLen:w.AttributeList.length,promiseLen:w.Promise.length};ui.imgIdArr.push({id:"SmallImage",imgurl:w.SmallImage});u.banner.push('<div class="mui-slider-item mui-slider-item-duplicate"><a href="#"><img src="../images/detailCache.png" id="'+u.banlast+'" /></a></div>');if(u.bLen>0){ui.imgIdArr.push({id:u.banlast,imgurl:w.ImageList[u.bLen-1].ImageUrl});for(var p=0;p<u.bLen;p++){var l=sui.unique(6);ui.imgIdArr.push({id:l,imgurl:w.ImageList[p].ImageUrl});u.banner.push('<div class="mui-slider-item"><a href="#"><img src="../images/detailCache.png" id="'+l+'"  data-preview-src="" data-preview-group="1"/></a></div>');u.indicator.push('<div class="mui-indicator '+(p==0?"mui-active":"")+'"></div>')}ui.imgIdArr.push({id:u.banfirst,imgurl:w.ImageList[0].ImageUrl})}u.banner.push('<div class="mui-slider-item mui-slider-item-duplicate"><a href="#"><img src="../images/detailCache.png" id="'+u.banfirst+'"/></a></div>');u.sbHtml.push('<div class="mui-table-view box-price"><div><span class="mui-badge mui-badge-warning mui-pull-left">'+w.SaleTypeTitle+"</span>"+ui.title+"</div>");u.sbHtml.push('<div class="price">'+w.RentTitle+'<span class="first">'+w.NowRent+'</span><span class="yuanjia">'+w.OldRent+"</span></div>");var v="";ui.content=w.RentTitle+w.NowRent;if(!sui.IsNullOrEmpty(w.Deposit)&&w.SaleType!=2){var q="";ui.content=w.RentTitle+w.NowRent+" 押金："+w.Deposit;if(w.SaleType==4&&!sui.IsNullOrEmpty(w.DinJin)){q='<span class="dingjin">定金：'+w.DinJin+"</span>";ui.content+="  定金："+w.DinJin}v='<div class="yajin">押金：'+w.Deposit+q+"</div>"}u.sbHtml.push(v+"</div>");if(w.IsGroup){ui.ProductType=1;u.sbHtml.push('<div class="guize"><div class="title"> 套餐内容 </div>');for(var h=0;h<u.groupLen;h++){u.sbHtml.push('<div class="pt3" data-v="'+w.GroupProductList[h].ProductSkuId+'">'+w.GroupProductList[h].Name+' <span class="mui-pull-right">'+w.GroupProductList[h].Count+"</span> </div>")}u.sbHtml.push("</div>")}if(w.HasCoupon){u.sbHtml.push('<div class="top6 mui-table-view-cell paquan" data="com" data-v="coupon"><a class="mui-navigate-right"><span class="mui-icon iconfont icon-quan align"></span><span  class="align">领取优惠券</span></a></div>')}if(u.attrLen>0){u.sbHtml.push('	<div class="zujin top6" data="attrbox"><div class="mui-table-view bottom"><span class="mui-color">选择规格</span></div>');for(var g=0;g<u.attrLen;g++){u.sbHtml.push('<p class="tit-guige">'+w.AttributeList[g].AttrName+'</p><div class="guige-box">');var d=w.AttributeList[g].AttrValList.length;for(var f=0;f<d;f++){var t="";var c=w.AttributeList[g].AttrValList[f].IsDisable;if(c){t="disabled"}else{t=w.AttributeList[g].AttrValList[f].IsSelected==true?"active":""}u.sbHtml.push('<span class="mui-badge '+t+'" data="'+(c==true?"":"attr")+'" data-v="'+w.AttributeList[g].AttrValList[f].AttrValId+'">'+w.AttributeList[g].AttrValList[f].AttrValName+"</span>")}u.sbHtml.push("</div>")}u.sbHtml.push("</div>")}if(w.HasRent){ui.isScheme=true;u.sbHtml.push('<div class="zujin top6 mui-table-view-cell" data="com" data-v="yajin"><a class="mui-navigate-right"><span class="mui-icon iconfont icon-qian align"></span><span class="align">选择押金方案</span><span class="mui-icon iconfont icon-duigou mui-pull-right mui-hidden" data="icon"></span></a></div>')}if(w.HasRule){u.sbHtml.push('<div class="zujin top6 mui-table-view-cell"  data="com" data-v="rule"><a class="mui-navigate-right" ><span class="mui-icon iconfont icon-gantanhao align"></span><span class="align">租赁规则</span> </a></div>')}u.sbHtml.push('<div class="zujin top6 mui-table-view-cell" data="com" data-v="addr"><a class="mui-navigate-right" ><span class="mui-icon iconfont icon-dizhi1 align"></span><span class="send align" id="sendAddr">送至 '+w.DeliveryAddress+'</span> <div class="divTip '+(w.ProductFlag==1?"":"mui-hidden")+'" id="divTip">该商品在所选地区暂不支持配送</div> </a></div>');if(u.promiseLen>0){u.sbHtml.push('<div class="zujin baozhang"><div class="bzgz">');for(var e=0;e<u.promiseLen;e++){u.sbHtml.push('<div class="icon-box"><span class="mui-icon iconfont icon-duigou"></span>'+w.Promise[e]+"</div>")}u.sbHtml.push("</div></div>")}u.sbHtml.push('<div  class="pic-box top6"><div class="youlike"><span class="through"></span><div class="box">继续拖动，查看图文详情</div></div> <div class="img-box"></div></div>');ui.sliderbox.classList.add("fadeIn-img");ui.sliderbox.innerHTML=u.banner.join("");ui.indicator.innerHTML=u.indicator.join("");ui.container.innerHTML=u.sbHtml.join("");if(w.ProductFlag==1){ui.addCart.classList.add("mui-disabled");ui.navtip.classList.remove("mui-hidden")}else{ui.addCart.classList.remove("mui-disabled");ui.navtip.classList.add("mui-hidden")}if(u.bLen){setTimeout(function(){mui.previewImage();mui("#slider").slider({interval:4000})},200)}if(w.ShoppingCarCount>0){ui.cartNum.innerText=w.ShoppingCarCount>99?"99+":w.ShoppingCarCount;ui.cartNum.style.display="block"}ui.navbox.classList.remove("mui-hidden");if(ui.MessageCount>0&&sui.isLogin()){ui.msgNum.innerText=ui.MessageCount;ui.msgNum.classList.remove("mui-hidden");var s=plus.webview.currentWebview().parent();if(s){s.evalJS('showMsg("'+ui.MessageCount+'")')}}downloadQueue();sui.closewait(ui.w);mui("#pullrefresh").pullRefresh().enablePullupToRefresh();mui("#pullrefresh").pullRefresh().refresh(true)}else{mui.toast(o.Desc);sui.closewait(ui.w)}}else{mui.toast("无法连接到服务器，请检查网络是否连接！");sui.closewait(ui.w)}})};mui(ui.container).on("tap","span[data=attr]",function(){var n=this;var o=n.className;if(~o.indexOf("active")){return}else{ui.w=sui.wait("请稍候...");var f=n.parentNode.querySelectorAll("span");var d=null;var a=f.length;for(var k=0;k<a;k++){var e=f[k].className;if(~e.indexOf("active")){d=f[k]}f[k].classList.remove("active")}n.classList.add("active");var g=document.querySelector('div[data="attrbox"]').querySelectorAll(".active");var l=g.length;var c="";for(var h=0;h<l;h++){c+=g[h].getAttribute("data-v")+","}if(!sui.IsNullOrEmpty(c)){c=c.substring(0,c.length-1);sui.request("Home/ProductDetailCondition",{productSkuId:ui.productSkuId,condition:c},true,function(t){if(t){var u=t.IsPass;if(u){ui.productSkuId=t.ReturnObject.ProductSkuId;var p=t.ReturnObject.IsRefrsh;if(p){ui.isRefresh=true;ui.schemeId=null;ui.isScheme=false;refreshDetail()}else{ui.isRefresh=false;var y=t.ReturnObject.AttributeList;var x=y.length;var j='<div class="mui-table-view bottom"><span class="mui-color">选择规格</span></div>';for(var v=0;v<x;v++){j+='<p class="tit-guige">'+y[v].AttrName+'</p><div class="guige-box">';var q=y[v].AttrValList.length;for(var z=0;z<q;z++){var w="";var i=y[v].AttrValList[z].IsDisable;if(i){w="disabled"}else{w=y[v].AttrValList[z].IsSelected==true?"active":""}j+='<span class="mui-badge '+w+'" data="'+(i==true?"":"attr")+'" data-v="'+y[v].AttrValList[z].AttrValId+'">'+y[v].AttrValList[z].AttrValName+"</span>"}j+="</div>"}document.querySelector('div[data="attrbox"]').innerHTML=j;sui.closewait(ui.w)}}else{for(var r=0;r<a;r++){f[r].classList.remove("active")}if(d){d.classList.add("active")}mui.toast(t.Desc);sui.closewait(ui.w)}}else{for(var r=0;r<a;r++){f[r].classList.remove("active")}if(d){d.classList.add("active")}mui.toast("无法连接到服务器，请检查网络是否连接");sui.closewait(ui.w)}})}else{for(var b=0;b<a;b++){f[b].classList.remove("active")}if(d){d.classList.add("active")}sui.closewait(ui.w)}}});function toggle(){mui("#topPopover").popover("toggle")}var call=function(b){var f=plus.android.importClass("android.content.Intent");var c=plus.android.importClass("android.net.Uri");var a=plus.android.runtimeMainActivity();var e=c.parse(b);var d=new f("android.intent.action.CALL",e);a.startActivity(d)};mui(ui.navbox).on("tap","a[data=nav]",function(){var c=this.getAttribute("data-v");if(c=="kefu"){var a="4009659288";var e=[{title:"400-965-9288"}];plus.nativeUI.actionSheet({cancel:"取消",buttons:e},function(g){if(g.index==1){if(mui.os.android){var f="tel:"+a;call(f)}else{plus.device.dial(a,false)}}})}else{if(c=="share"){mui("#Share").popover("toggle")}else{var b={main:plus.webview.getWebviewById("main.html"),list:plus.webview.getWebviewById("goodsList.html"),ordermanage:plus.webview.getWebviewById("orderManageMain.html"),orderdetail:plus.webview.getWebviewById("orderDetail.html"),reserveMain:plus.webview.getWebviewById("reserveMain.html"),recoverDetail:plus.webview.getWebviewById("recoverDetail.html"),recoverMain:plus.webview.getWebviewById("recoverMain.html"),recover:plus.webview.getWebviewById("recover.html"),repaydetail:plus.webview.getWebviewById("repaymentDetail.html"),barterDetail:plus.webview.getWebviewById("barterDetail.html")};mui.fire(b.main,"GoCart");if(b.list){b.list.close("none",0);var d=plus.webview.getWebviewById("goodsMenu.html");if(d){d.close("none",0)}}if(b.ordermanage){b.ordermanage.close("none",0)}if(b.orderdetail){b.orderdetail.close("none",0)}if(b.reserveMain){b.reserveMain.close("none",0)}if(b.recoverDetail){b.recoverDetail.close("none",0)}if(b.recoverMain){b.recoverMain.close("none",0)}if(b.recover){b.recover.close("none",0)}if(b.repaydetail){b.repaydetail.close("none",0)}if(b.barterDetail){b.barterDetail.close("none",0)}setTimeout(function(){b.main.show()},150);setTimeout(function(){var f=plus.webview.currentWebview().parent();f.close("none",0)},450)}}});var shareMessage=function(d,c,b){var g={extra:{scene:c}};g.href=ui.MobileWebUrl;var a="擦一擦";var f=ui.title;var e=ui.content;f=f.length>25?f.substring(0,25)+"...":f;e=e.length>30?e.substring(0,30)+"...":e;if(b==3){e=e+ui.MobileWebUrl}if(!sui.IsNullOrEmpty(e)){a=e}if(!sui.IsNullOrEmpty(f)){a=f}g.title=a;g.content=e==""?"来自擦一擦的分享："+ui.MobileWebUrl:e;g.thumbs=["_www/images/appicon.png"];g.pictures=["_www/images/appicon.png"];d.send(g,function(){},function(h){})};var shareAction=function(d,b,a){var c=null;if(!d||!(c=ui.shares[d])){mui.toast("无效的分享服务！");return}if(c.authenticated){shareMessage(c,b,a)}else{c.authorize(function(){shareMessage(c,b,a)},function(f){})}};function copyVal(f){if(plus.os.name=="Android"){var c=plus.android.importClass("android.content.Context");var a=plus.android.runtimeMainActivity();var d=a.getSystemService(c.CLIPBOARD_SERVICE);plus.android.invoke(d,"setText",f)}else{var b=plus.ios.importClass("UIPasteboard");var e=b.generalPasteboard();e.setValueforPasteboardType(f,"public.utf8-plain-text")}mui.toast("已复制到剪贴板")}mui("body").on("tap","a[class=share_li]",function(){var d=this;var b=parseInt(d.getAttribute("sid"));var a=ui.title+" (分享自@擦一擦)。 "+ui.MobileWebUrl;if(b==4){var e=plus.messaging.createMessage(plus.messaging.TYPE_SMS);e.body=a;plus.messaging.sendMessage(e)}else{if(b==5){var e=plus.messaging.createMessage(plus.messaging.TYPE_EMAIL);e.body=a;plus.messaging.sendMessage(e)}else{if(b==6){plus.runtime.openURL(ui.MobileWebUrl)}else{if(b==7){copyVal(ui.MobileWebUrl)}else{var c=[{id:"weixin",ex:"WXSceneSession"},{id:"weixin",ex:"WXSceneTimeline"},{id:"qq"},{id:"sinaweibo"}];shareAction(c[b].id,c[b].ex,b)}}}}mui("#Share").popover("toggle")});ui.addCart.addEventListener("tap",function(){if(!sui.isLogin()){sui.open("../login.html","login.html",{});return}if(!ui.isRefresh){mui.toast("请选择规格");return}else{if(ui.isScheme&&!ui.schemeId){mui.toast("请选择押金方案");return}else{if(!ui.areaCode){mui.toast("请选择配送地址");return}}}ui.w=sui.wait("请稍候...");var a={SkuId:ui.productSkuId,BuyNum:1,SkuRentRuleId:ui.schemeId,ProductType:ui.ProductType,AreaCode:ui.areaCode};sui.request("Order/AddCart",a,false,function(c){if(c){var b=c.IsPass;if(b){ui.SmallImage.classList.add("carts");setTimeout(function(){ui.SmallImage.classList.remove("carts");ui.carts.classList.add("icon-cart");setTimeout(function(){ui.carts.classList.remove("icon-cart");ui.cartNum.innerText=parseInt(ui.cartNum.innerText)+1;ui.cartNum.style.display="block"},500)},500);sui.closewait(ui.w)}else{if(c.StatusCode=="S0017"){mui.toast("登录已过期，请重新登录");sui.open("../login.html","login.html",{});sui.removeToken()}else{mui.toast(c.Desc)}sui.closewait(ui.w)}}else{mui.toast("无法连接到服务器，请检查网络是否连接！");sui.closewait(ui.w)}})});mui(ui.container).on("tap","div[data=com]",function(){var a=this.getAttribute("data-v");if(a=="yajin"){sui.open("depositScheme.html","depositScheme.html",{pid:ui.productSkuId,schemeId:ui.schemeId})}else{if(a=="coupon"){sui.open("receiveCoupon.html","receiveCoupon.html",{pid:ui.productSkuId})}else{if(a=="rule"){sui.open("rule.html","rule.html",{pid:ui.productSkuId})}else{if(a=="addr"){sui.open("addrPicker.html","addrPicker.html",{addrId:ui.addrId,addressList:ui.ShouHuoAddressList})}}}}});function Rent(b){ui.schemeId=b;var a=document.querySelector('span[data="icon"]');if(a){a.classList.remove("mui-hidden")}}mui(ui.container).on("tap","div[class=pt3]",function(){var a=this.getAttribute("data-v");sui.open("goodsDetailMain.html","goodsDetailMain2.html",{pid:a})});mui("#topPopover").on("tap","li[data=menu]",function(){var e=this.getAttribute("data-v");var c=plus.webview.currentWebview().parent();mui("#topPopover").popover("toggle");if(e=="index"){var d={main:plus.webview.getWebviewById("main.html"),list:plus.webview.getWebviewById("goodsList.html"),ordermanage:plus.webview.getWebviewById("orderManageMain.html"),orderdetail:plus.webview.getWebviewById("orderDetail.html"),reserveMain:plus.webview.getWebviewById("reserveMain.html"),recoverDetail:plus.webview.getWebviewById("recoverDetail.html"),recoverMain:plus.webview.getWebviewById("recoverMain.html"),recover:plus.webview.getWebviewById("recover.html"),repaydetail:plus.webview.getWebviewById("repaymentDetail.html"),barterDetail:plus.webview.getWebviewById("barterDetail.html")};mui.fire(d.main,"gohome");if(d.list){d.list.close("none",0);var f=plus.webview.getWebviewById("goodsMenu.html");if(f){f.close("none",0)}}if(d.ordermanage){d.ordermanage.close("none",0)}if(d.orderdetail){d.orderdetail.close("none",0)}if(d.reserveMain){d.reserveMain.close("none",0)}if(d.recoverDetail){d.recoverDetail.close("none",0)}if(d.recoverMain){d.recoverMain.close("none",0)}if(d.recover){d.recover.close("none",0)}if(d.repaydetail){d.repaydetail.close("none",0)}if(d.barterDetail){d.barterDetail.close("none",0)}setTimeout(function(){d.main.show()},150);setTimeout(function(){c.close("none",0)},450)}else{if(e=="search"){var b=plus.webview.getWebviewById("goodsList.html");if(b){b.show("pop-in",200);setTimeout(function(){c.close("none",0)},500)}else{sui.open("goodSearch.html","goodSearch.html",{})}}else{if(!sui.isLogin()){sui.open("../login.html","login.html",{});return}sui.open("../my/message.html","message.html",{});if(ui.MessageCount>0){ui.msgNum.classList.add("mui-hidden");if(c){c.evalJS('hideMsg("'+ui.MessageCount+'")')}var a=plus.webview.getWebviewById("default.html");if(a){a.evalJS("removeMsgNum();")}}}}});var CheckSkuDeliveryArea=function(b,a){ui.w=sui.wait("请稍候...");sui.request("Home/CheckSkuDeliveryArea",{productSkuId:ui.productSkuId,areaCode:a},true,function(f){if(f){var d=f.IsPass;if(d){var e=f.ReturnObject;var c=document.querySelector("#divTip");if(e){if(c){c.classList.add("mui-hidden")}ui.navtip.classList.add("mui-hidden");ui.addCart.classList.remove("mui-disabled")}else{if(c){c.classList.remove("mui-hidden")}ui.navtip.classList.remove("mui-hidden");ui.addCart.classList.add("mui-disabled")}sui.closewait(ui.w)}else{mui.toast(f.Desc);sui.closewait(ui.w)}}else{mui.toast("无法连接到服务器，请检查网络是否连接");sui.closewait(ui.w)}})};function checkAddr(c,d,a){ui.addrId=a;ui.areaCode=c;var b=document.querySelector("#sendAddr");if(b){b.innerText="送至 "+d}localStorage.setItem("areaCode_cayica",c);CheckSkuDeliveryArea(ui.productSkuId,c)};