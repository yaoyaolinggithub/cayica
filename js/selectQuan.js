var ui={w:null,item1mobile:sui.gel("item1mobile"),item2mobile:sui.gel("item2mobile"),yajinId:"",yajinPrice:0,zujinId:"",quanIds:"",cartstr:"",canUse:0,unUsed:0,pannel1:sui.gel("pannel1"),pannel2:sui.gel("pannel2"),btnSure:sui.gel("btnSure"),boxs:sui.gel("boxs")};var template=function(b){var c=b.QuanType==0?"border":"";var a={fontsize:"",len:b.Amount.toString().length,badge:b.RemindExpire==1?'<a class="mui-badge">即将过期</a>':"",border:b.IsGray?c+" border2":(b.QuanType==0?"border":""),primary:"main"};if(a.len==4){a.fontsize="font-size3"}if(a.len>=5){a.fontsize="font-size5"}var d=b.QuanType==0?"main ":"primary ";a.primary=b.IsGray?d+"gray "+a.fontsize:d+a.fontsize;if(!b.IsUse){a.primary="gray "+a.fontsize;a.border="border2"}var d=['<div class="quan-box"  data="'+b.MyQuanId+'" data-t="'+b.QuanType+'" data-p="'+b.Amount+'"><img  src="../images/check.png" class="img '+(b.IsSelected?"":"mui-hidden")+'"/>','<div class="desc '+a.border+'" data="border"><div class="box">','<span class="mui-badge-circle">'+(b.QuanType==0?"押":"租")+'</span><span class="quandesc">','<span class="mui-ellipsis">'+b.Name+a.badge+"</span>",'<span class="mui-ellipsis">满'+b.MinCharge+"可用，"+b.Category+"</span>",'</span></div><div class="date"> 有效日期：'+b.ValidTerm+"</div>",'</div><ul class="quan" ><li class="'+a.primary+'"><span class="sign">¥</span>'+b.Amount+"</li></ul></div>"].join("");return d};(function(a){a.plusReady(function(){a.init({beforeback:function(){var c=plus.webview.currentWebview().opener();if(c){c.evalJS('selectQuan("'+ui.yajinId+'","'+ui.zujinId+'","'+ui.yajinPrice+'");')}}});var b=plus.webview.currentWebview();ui.quanIds=b.quanIds;ui.cartstr=b.cartstr;setTimeout(function(){ui.w=sui.wait("正在加载...");sui.request("Order/GetCartQuan",{cartstr:ui.cartstr,quanIds:ui.quanIds},true,function(h){if(h){var g=h.IsPass;if(g){var d=h.ReturnObject.length;var e="";var j="";for(var f=0;f<d;f++){var c={MyQuanId:h.ReturnObject[f].MyQuanId,Name:h.ReturnObject[f].Name,Amount:h.ReturnObject[f].Amount.toFixed(0),MinCharge:h.ReturnObject[f].MinCharge.toFixed(0),QuanType:h.ReturnObject[f].QuanType,ValidTerm:h.ReturnObject[f].ValidTerm,Category:h.ReturnObject[f].Category,RemindExpire:h.ReturnObject[f].RemindExpire,IsUse:h.ReturnObject[f].IsUse,IsSelected:h.ReturnObject[f].IsSelected,IsGray:h.ReturnObject[f].IsGray};if(c.IsUse){ui.canUse++;e+=template(c)}else{ui.unUsed++;j+=template(c)}}if(ui.canUse){ui.pannel1.innerText="可用优惠券("+ui.canUse+")";ui.item1mobile.innerHTML=e;ui.btnSure.classList.remove("mui-hidden")}else{ui.item1mobile.innerHTML='<div class="noneQuan"><div class="mui-icon iconfont icon-comiiszanwushuju"></div><div class="word">您还没有可用优惠券</div></div>'}if(ui.unUsed){ui.pannel2.innerText="不可用优惠券("+ui.unUsed+")";ui.item2mobile.innerHTML=j}else{ui.item2mobile.innerHTML='<div class="noneQuan"><div class="mui-icon iconfont icon-comiiszanwushuju"></div><div class="word">您还没有不可使用的优惠券</div></div>'}sui.closewait(ui.w)}else{mui.toast(h.Desc);sui.closewait(ui.w)}}else{mui.toast("无法连接到服务器，请检查网络是否连接");sui.closewait(ui.w)}})},250);ui.btnSure.addEventListener("tap",function(){var c=plus.webview.currentWebview().opener();if(c){c.evalJS('selectQuan("'+ui.yajinId+'","'+ui.zujinId+'","'+ui.yajinPrice+'");')}plus.webview.currentWebview().close()})})})(mui);mui("#sliderSegmentedControl").on("tap","a",function(){var a=this.id;if(a=="pannel1"){ui.boxs.style.paddingBottom="60px";ui.btnSure.classList.remove("mui-hidden")}else{ui.boxs.style.paddingBottom="0px";ui.btnSure.classList.add("mui-hidden")}});mui(ui.item1mobile).on("tap","div[class=quan-box]",function(){var e=this;var d=e.getAttribute("data-t");if(e.querySelector("img").classList.contains("mui-hidden")){if(d==1){ui.zujinId=e.getAttribute("data")}else{ui.yajinId=e.getAttribute("data");ui.yajinPrice=e.getAttribute("data-p")}var c=ui.item1mobile.querySelectorAll('div[data-t="'+d+'"]');var a=c.length;for(var b=0;b<a;b++){c[b].querySelector("img").classList.add("mui-hidden");c[b].querySelector("div[data=border]").classList.add("border2");c[b].querySelector("li").classList.add("gray")}e.querySelector("img").classList.remove("mui-hidden");e.querySelector("div[data=border]").classList.remove("border2");e.querySelector("li").classList.remove("gray")}else{if(d==1){ui.zujinId=""}else{ui.yajinId="";ui.yajinPrice=0}var c=ui.item1mobile.querySelectorAll('div[data-t="'+d+'"]');var a=c.length;for(var b=0;b<a;b++){c[b].querySelector("img").classList.add("mui-hidden");c[b].querySelector("div[data=border]").classList.remove("border2");c[b].querySelector("li").classList.remove("gray")}}});