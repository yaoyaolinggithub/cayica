var ui={item1mobile:sui.gel("item1mobile"),item2mobile:sui.gel("item2mobile"),item3mobile:sui.gel("item3mobile"),item4mobile:sui.gel("item4mobile"),orderState:-99,index1:1,index2:1,index3:1,index4:1,w:null,elem:null,container:null,index:1,Arr:sui.gel("sliderSegmentedControl").querySelectorAll("a"),panelTitle1:sui.gel("panelTitle1"),panelTitle2:sui.gel("panelTitle2"),panelTitle3:sui.gel("panelTitle3"),panelTitle4:sui.gel("panelTitle4"),imgIdArr:[],pullrefresh:sui.gel("pullrefresh"),isrefresh1:false,isrefresh2:false,isrefresh3:false,isrefresh4:false,loopPullDown:null};var disabledTap=function(){mui.each(ui.Arr,function(a,b){b.classList.add("mui-disabled")})};var recoverTap=function(){mui.each(ui.Arr,function(a,b){b.classList.remove("mui-disabled")})};var goodsTemplate=function(k){var a=k.length;var f="";for(var e=0;e<a;e++){var c=sui.unique(6);ui.imgIdArr.push({id:c,imgurl:k[e].CoverImage});var g=JSON.parse(k[e].SkuAttribute||"[]");var h=g.length;var l="";for(var b=0;b<h;b++){if(b==2){break}l+='<span class="guige">'+g[b].AttrName+"："+g[b].AttrVal+" </span>"}var d=['<li class="mui-table-view-cell"><img src="../images/hand.png"  id="'+c+'"/>','<div class="order_tit"><div class="mui-ellipsis-2 tit" >'+k[e].OuterName+"</div>"+l,'<span class="price absolute">定金：¥'+sui.rmoney(k[e].DingJin)+'<sapn class="yajin">押金：¥'+sui.rmoney(k[e].NowDeposit)+"</sapn></span></div>",'<span class="mui-badge">×'+k[e].BuyNum+"</span></li>"].join("");f+=d}return f};var call=function(b){var f=plus.android.importClass("android.content.Intent");var c=plus.android.importClass("android.net.Uri");var a=plus.android.runtimeMainActivity();var e=c.parse(b);var d=new f("android.intent.action.CALL",e);a.startActivity(d)};var template=function(a){var d=goodsTemplate(a.Detail);var c={buttons:"",word:"",kefu:'<button type="button" class="mui-btn  mui-btn-outlined gray" data="4009659288" data-t="kefu">联系客服</button>',html:null};switch(a.State){case -1:c.buttons=c.kefu;c.buttons+='<button type="button" class="mui-btn mui-btn-outlined mui-btn-danger" data-t="del">删除订单</button>';c.word="已关闭";c.html='<div class="item1-tit2"> 共'+a.ProductNum+"件商品  应付定金：¥"+sui.rmoney(a.DingJin)+" </div>";break;case -2:c.buttons=c.kefu;c.buttons+='<button type="button" class="mui-btn mui-btn-outlined mui-btn-danger" data-t="del">删除订单</button>';c.word="已取消";c.html='<div class="item1-tit2"> 共'+a.ProductNum+"件商品  应付定金：¥"+sui.rmoney(a.DingJin)+" </div>";break;case -3:c.buttons=c.kefu;c.buttons+='<button type="button" class="mui-btn mui-btn-outlined red mui-btn-danger" data-t="yukuan">付差价</button>';c.word="待付差价";c.html='<div class="item1-tit2"> 共'+a.ProductNum+"件商品  待付换货差价：¥"+sui.rmoney(a.DifferencePrice)+" </div>";break;case 0:c.buttons=c.kefu;c.buttons+='<button type="button" class="mui-btn  mui-btn-outlined gray" data-t="cancle">取消订单</button>';c.buttons+='<button type="button" class="mui-btn mui-btn-outlined red mui-btn-danger" data-t="dingjin">付定金</button>';c.buttons+='<button type="button" class="mui-btn mui-btn-outlined red mui-btn-danger mui-hidden" data-t="quankuan">付全款</button>';c.word="待付定金";c.html='<div class="item1-tit2"> 共'+a.ProductNum+"件商品 </div>";c.html+='<div class="item1-tit2  mui-table-view">应付定金：¥'+sui.rmoney(a.DingJin)+'  <span class="yajin">应付全款：¥'+sui.rmoney(a.QuanKuan)+"</span></div>";break;case 1:c.buttons=c.kefu;c.buttons+='<button type="button" class="mui-btn mui-btn-outlined red mui-btn-danger" data-t="yukuan">付余款</button>';c.word="待付余款";c.html='<div class="item1-tit2"> 共'+a.ProductNum+"件商品  应付余款：¥"+sui.rmoney(a.YuKuan)+" </div>";break;case 2:c.buttons=c.kefu;c.word="准备出库";c.html='<div class="item1-tit2"> 共'+a.ProductNum+"件商品  应付余款：¥"+sui.rmoney(a.YuKuan)+" </div>";break;case 3:c.buttons=c.kefu;c.word="付款失败";c.html='<div class="item1-tit2"> 共'+a.ProductNum+"件商品  应付余款：¥"+sui.rmoney(a.YuKuan)+" </div>";break;case 4:c.buttons=c.kefu;c.word="准备出库";c.html='<div class="item1-tit2"> 共'+a.ProductNum+"件商品  应付余款：¥"+sui.rmoney(a.YuKuan)+" </div>";break;case 5:c.buttons=c.kefu;c.word="付款失败";c.html='<div class="item1-tit2"> 共'+a.ProductNum+"件商品  应付余款：¥"+sui.rmoney(a.YuKuan)+" </div>";break;case 6:c.buttons=c.kefu;c.buttons+='<button type="button" class="mui-btn  mui-btn-outlined gray"  data-t="wuliu">查看物流</button>';c.buttons+='<button type="button" class="mui-btn  mui-btn-outlined gray mui-hidden" data-t="cuidan">我要催单</button>';c.html='<div class="item1-tit2"> 共'+a.ProductNum+"件商品  已付款：¥"+sui.rmoney(a.PaidQuanKuan)+" </div>";c.word="等待发货";break;case 7:c.buttons=c.kefu;c.buttons+='<button type="button" class="mui-btn  mui-btn-outlined gray"  data-t="wuliu">查看物流</button>';c.buttons+='<button type="button" class="mui-btn mui-btn-outlined mui-btn-danger mui-hidden" data-t="over">确认收货</button>';c.html='<div class="item1-tit2"> 共'+a.ProductNum+"件商品  已付款：¥"+sui.rmoney(a.PaidQuanKuan)+" </div>";c.word="等待收货";break;case 8:c.buttons=c.kefu;c.buttons+='<button type="button" class="mui-btn  mui-btn-outlined gray"  data-t="wuliu">查看物流</button>';c.word="已收货";c.html='<div class="item1-tit2"> 共'+a.ProductNum+"件商品  已付款：¥"+sui.rmoney(a.PaidQuanKuan)+" </div>";break;case 9:c.buttons='<button type="button" class="mui-btn  mui-btn-outlined gray"  data-t="wuliu">查看物流</button>';c.buttons+='<button type="button" class="mui-btn mui-btn-outlined mui-btn-danger" data-t="del">删除订单</button>';c.word="已完成";c.html='<div class="item1-tit2"> 共'+a.ProductNum+"件商品  已付款：¥"+sui.rmoney(a.PaidQuanKuan)+" </div>";break;case 10:c.buttons='<button type="button" class="mui-btn  mui-btn-outlined gray"  data-t="wuliu">查看物流</button>';c.buttons+='<button type="button" class="mui-btn mui-btn-outlined mui-btn-danger" data-t="del">删除订单</button>';c.word="已归还";c.html='<div class="item1-tit2"> 共'+a.ProductNum+"件商品  已付款：¥"+sui.rmoney(a.PaidQuanKuan)+" </div>";break;case 11:c.buttons='<button type="button" class="mui-btn  mui-btn-outlined gray"  data-t="wuliu">查看物流</button>';c.buttons+='<button type="button" class="mui-btn mui-btn-outlined mui-btn-danger" data-t="del">删除订单</button>';c.word="已完成";c.html='<div class="item1-tit2"> 共'+a.ProductNum+"件商品  已付款：¥"+sui.rmoney(a.PaidQuanKuan)+" </div>";break;case 12:c.buttons='<button type="button" class="mui-btn  mui-btn-outlined gray"  data-t="wuliu">查看物流</button>';c.buttons+='<button type="button" class="mui-btn mui-btn-outlined mui-btn-danger" data-t="del">删除订单</button>';c.word="已退款";c.html='<div class="item1-tit2"> 共'+a.ProductNum+"件商品  已付款：¥"+sui.rmoney(a.PaidQuanKuan)+" </div>";break;default:break}var b=['<div class="item1-tit">','<span class="mui-ellipsis">',"订单号:"+a.OrderCode+'</span> <span class="mui-pull-right">'+c.word+"</span>",'</div><ul class="mui-table-view list" data="detail"> '+d+"</ul>",c.html+'<div class="mui-table-view bg">'+c.buttons+"</div>"].join("");return b};(function(a){a.init({pullRefresh:{container:"#pullrefresh",down:{callback:pulldownRefresh},up:{callback:pullupRefresh}}});a.plusReady(function(){ui.type=0;ui.container=ui.item1mobile;ui.index=ui.index1;setTimeout(function(){a("#pullrefresh").pullRefresh().pullupLoading()},180)})})(mui);function pulldownRefresh(){disabledTap();var a={container:ui.container,orderState:ui.orderState};clearTimeout(ui.loopPullDown);setTimeout(function(){sui.request("Order/GetOrderList",{orderState:a.orderState,orderType:3,pageIndex:1},true,function(e){if(e){var j=e.IsPass;if(j){var c=e.ReturnList.length;a.container.innerHTML="";if(c>0){ui.elem=sui.rtips(ui.elem);var h=sui.fragment();for(var f=0;f<c;f++){var k={Id:e.ReturnList[f].MyOrder.Id,OrderCode:e.ReturnList[f].MyOrder.OrderCode,PaidPrice:e.ReturnList[f].MyOrder.PaidPrice,ProductNum:e.ReturnList[f].MyOrder.ProductNum,State:e.ReturnList[f].MyOrder.State,Detail:e.ReturnList[f].MyOrderDetail,OrderType:e.ReturnList[f].MyOrder.OrderType,DingJin:e.ReturnList[f].MyOrder.DingJin,YuKuan:e.ReturnList[f].MyOrder.YuKuan,QuanKuan:e.ReturnList[f].MyOrder.QuanKuan,PaidQuanKuan:e.ReturnList[f].MyOrder.PaidQuanKuan,DifferencePrice:e.ReturnList[f].MyOrder.DifferencePrice};var b=document.createElement("div");b.className="item1-box";b.setAttribute("data",k.Id);b.setAttribute("data-v",k.OrderCode);b.innerHTML=template(k);h.appendChild(b)}a.container.appendChild(h);var g=ui.imgIdArr.length;for(var d=0;d<g;d++){cache.setImg(ui.imgIdArr[d].id,ui.imgIdArr[d].imgurl)}ui.imgIdArr=[];switch(a.orderState){case -99:ui.index1=2;ui.index=ui.index1;break;case 0:ui.index2=2;ui.index=ui.index2;break;case 1:ui.index3=2;ui.index=ui.index3;break;case 7:ui.index4=2;ui.index=ui.index4;break;default:break}mui("#pullrefresh").pullRefresh().endPulldownToRefresh();ui.loopPullDown=setTimeout(function(){mui("#pullrefresh").pullRefresh().enablePullupToRefresh();mui("#pullrefresh").pullRefresh().refresh(true)},1000)}else{switch(a.orderState){case -99:ui.index1=1;ui.index=ui.index1;break;case 0:ui.index2=1;ui.index=ui.index2;break;case 1:ui.index3=1;ui.index=ui.index3;break;case 7:ui.index4=1;ui.index=ui.index4;break;default:break}mui("#pullrefresh").pullRefresh().endPulldownToRefresh();mui("#pullrefresh").pullRefresh().disablePullupToRefresh();if(!ui.elem){ui.elem=sui.ctips("comiiszanwushuju","暂无相关数据")}}}else{mui("#pullrefresh").pullRefresh().endPulldownToRefresh();mui.toast(e.Desc)}recoverTap()}else{mui("#pullrefresh").pullRefresh().endPulldownToRefresh();mui.toast("无法连接到服务器，请检查网络是否连接！");recoverTap()}})},400)}function pullupRefresh(){disabledTap();var a={container:ui.container,orderState:ui.orderState,index:ui.index};setTimeout(function(){sui.request("Order/GetOrderList",{orderState:a.orderState,orderType:3,pageIndex:a.index},true,function(e){if(e){var j=e.IsPass;if(j){var c=e.ReturnList.length;if(c>0){ui.elem=sui.rtips(ui.elem);var h=sui.fragment();for(var f=0;f<c;f++){var k={Id:e.ReturnList[f].MyOrder.Id,OrderCode:e.ReturnList[f].MyOrder.OrderCode,PaidPrice:e.ReturnList[f].MyOrder.PaidPrice,ProductNum:e.ReturnList[f].MyOrder.ProductNum,State:e.ReturnList[f].MyOrder.State,Detail:e.ReturnList[f].MyOrderDetail,OrderType:e.ReturnList[f].MyOrder.OrderType,DingJin:e.ReturnList[f].MyOrder.DingJin,YuKuan:e.ReturnList[f].MyOrder.YuKuan,QuanKuan:e.ReturnList[f].MyOrder.QuanKuan,PaidQuanKuan:e.ReturnList[f].MyOrder.PaidQuanKuan,DifferencePrice:e.ReturnList[f].MyOrder.DifferencePrice};var b=document.createElement("div");b.className="item1-box";b.setAttribute("data",k.Id);b.setAttribute("data-v",k.OrderCode);b.innerHTML=template(k);h.appendChild(b)}a.container.appendChild(h);var g=ui.imgIdArr.length;for(var d=0;d<g;d++){cache.setImg(ui.imgIdArr[d].id,ui.imgIdArr[d].imgurl)}ui.imgIdArr=[];switch(a.orderState){case -99:ui.index1++;ui.index=ui.index1;break;case 0:ui.index2++;ui.index=ui.index2;break;case 1:ui.index3++;ui.index=ui.index3;break;case 7:ui.index4++;ui.index=ui.index4;break;default:break}mui("#pullrefresh").pullRefresh().endPullupToRefresh(false)}else{if(ui.index==1){mui("#pullrefresh").pullRefresh().endPullupToRefresh(true);mui("#pullrefresh").pullRefresh().disablePullupToRefresh();if(!ui.elem){ui.elem=sui.ctips("comiiszanwushuju","暂无相关数据")}}else{mui("#pullrefresh").pullRefresh().endPullupToRefresh(true)}}}else{mui.toast(e.Desc);mui("#pullrefresh").pullRefresh().endPullupToRefresh(false)}recoverTap()}else{mui.toast("无法连接到服务器，请检查网络是否连接！");mui("#pullrefresh").pullRefresh().endPullupToRefresh(false);recoverTap()}})},400)}var tapRefresh=function(a,b){if(ui.index==1){setTimeout(function(){mui("#pullrefresh").pullRefresh().disablePullupToRefresh();mui("#pullrefresh").pullRefresh().pulldownLoading()},100)}else{if(a){setTimeout(function(){mui("#pullrefresh").pullRefresh().pulldownLoading();switch(b){case -99:ui.isrefresh1=false;break;case 0:ui.isrefresh2=false;break;case 1:ui.isrefresh3=false;break;case 7:ui.isrefresh4=false;break;default:break}},100)}else{mui("#pullrefresh").pullRefresh().enablePullupToRefresh()}}};var PayOrder=function(a){ui.w=sui.wait("请稍候...");sui.post("Order/PayOrder",{orderIds:a,orderType:0},function(d){if(d){var c=d.IsPass;if(c){var b={PayWaterId:d.ReturnObject.PayWaterId,Amount:d.ReturnObject.Amount,PayTitle:d.ReturnObject.PayTitle,IsNeedPay:d.ReturnObject.IsNeedPay};if(b.IsNeedPay){sui.open("orderPay.html","orderPay.html",{PayWaterId:b.PayWaterId,Amount:b.Amount,PayTitle:b.PayTitle,payType:1})}else{mui.toast("订单付款成功");beforeRefresh()}sui.closewait(ui.w)}else{mui.toast(d.Desc);sui.closewait(ui.w)}}else{mui.toast("无法连接到服务器，请检查网络是否连接");sui.closewait(ui.w)}})};mui("#sliderSegmentedControl").on("tap","a[data=tap]",function(){var b=this;if(~b.className.indexOf("mui-active")){mui("#pullrefresh").pullRefresh().scrollTo(0,0,200);return}var a=b.id;ui.elem=sui.rtips(ui.elem);if(mui.os.ios){mui("#pullrefresh").pullRefresh().scrollTo(0,0,0)}else{mui("#pullrefresh").pullRefresh().scrollTo(0,0,100)}if(a=="panelTitle1"){ui.orderState=-99;ui.container=ui.item1mobile;ui.index=ui.index1;tapRefresh(ui.isrefresh1,ui.orderState)}else{if(a=="panelTitle2"){ui.orderState=0;ui.container=ui.item2mobile;ui.index=ui.index2;tapRefresh(ui.isrefresh2,ui.orderState)}else{if(a=="panelTitle3"){ui.orderState=1;ui.container=ui.item3mobile;ui.index=ui.index3;tapRefresh(ui.isrefresh3,ui.orderState)}else{if(a=="panelTitle4"){ui.orderState=7;ui.container=ui.item4mobile;ui.index=ui.index4;tapRefresh(ui.isrefresh4,ui.orderState)}}}}});mui("#pullrefresh").on("tap","button[type=button]",function(){var f=this;var d=f.getAttribute("data-t");if(d=="kefu"){var c="4009659288";var g=[{title:"400-965-9288"}];plus.nativeUI.actionSheet({cancel:"取消",buttons:g},function(i){if(i.index==1){if(mui.os.android){var h="tel:"+c;call(h)}else{plus.device.dial(c,false)}}})}else{if(d=="cancle"){var g=[{title:"确认",style:"destructive"}];plus.nativeUI.actionSheet({title:"确认要取消该订单吗?",cancel:"取消",buttons:g},function(h){if(h.index==1){var i=f.parentNode.parentNode.getAttribute("data");ui.w=sui.wait("请稍候...");sui.post("Order/CancelOrder",{orderId:i},function(k){if(k){var j=k.IsPass;if(j){sui.closewait(ui.w);mui.toast("订单取消成功");mui("#pullrefresh").pullRefresh().pulldownLoading();switch(ui.orderState){case -99:ui.isrefresh2=true;break;case 1:ui.isrefresh1=true;break;default:break}}else{mui.toast(k.Desc);sui.closewait(ui.w)}}else{mui.toast("无法连接到服务器，请检查网络是否连接！");sui.closewait(ui.w)}})}})}else{if(d=="dingjin"||d=="quankuan"||d=="yukuan"){var a=f.parentNode.parentNode.getAttribute("data");PayOrder(a)}else{if(d=="wuliu"){var e=f.parentNode.parentNode;var a=e.getAttribute("data");var b=e.getAttribute("data-v");sui.open("logistics.html","logistics.html",{orderId:a,orderCode:b})}else{if(d=="del"){var g=[{title:"确认",style:"destructive"}];plus.nativeUI.actionSheet({title:"确认要删除该订单吗?",cancel:"取消",buttons:g},function(h){if(h.index==1){var i=f.parentNode.parentNode.getAttribute("data");ui.w=sui.wait("请稍候...");sui.post("Order/DeleteOrder",{orderId:i},function(k){if(k){var j=k.IsPass;if(j){sui.closewait(ui.w);mui.toast("订单删除成功");mui("#pullrefresh").pullRefresh().pulldownLoading();switch(ui.orderState){case -99:ui.isrefresh2=true;break;case 1:ui.isrefresh1=true;break;default:break}}else{mui.toast(k.Desc);sui.closewait(ui.w)}}else{mui.toast("无法连接到服务器，请检查网络是否连接！");sui.closewait(ui.w)}})}})}else{if(d=="cuidan"){}else{if(d=="over"){}}}}}}}});mui("#pullrefresh").on("tap","ul[data=detail]",function(){var a=this.parentNode.getAttribute("data");sui.open("orderDetail.html","orderDetail.html",{orderId:a})});function beforeRefresh(){ui.isrefresh1=true;ui.isrefresh2=true;ui.isrefresh3=true;ui.isrefresh4=true;mui("#pullrefresh").pullRefresh().pulldownLoading()};