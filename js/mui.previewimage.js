(function(d,g){var i='<div id="{{id}}" class="mui-slider mui-preview-image mui-fullscreen"><div class="mui-preview-header">{{header}}</div><div class="mui-slider-group"></div><div class="mui-preview-footer mui-hidden">{{footer}}</div><div class="mui-preview-loading"><span class="mui-spinner mui-spinner-white"></span></div></div>';var h='<div class="mui-slider-item mui-zoom-wrapper {{className}}"><div class="mui-zoom-scroller"><img src="{{src}}" data-preview-lazyload="{{lazyload}}" style="{{style}}" class="mui-zoom"></div></div>';var f="__DEFAULT";var a=document.createElement("div");var c=0;var b=function(k){this.options=d.extend(true,{id:"__MUI_PREVIEWIMAGE",zoom:true,header:'<span class="mui-preview-indicator"></span>',footer:""},k||{});this.init();this.initEvent()};var e=b.prototype;e.init=function(){var k=this.options;var l=document.getElementById(this.options.id);if(!l){a.innerHTML=i.replace(/\{\{id\}\}/g,this.options.id).replace("{{header}}",k.header).replace("{{footer}}",k.footer);document.body.appendChild(a.firstElementChild);l=document.getElementById(this.options.id)}this.element=l;this.scroller=this.element.querySelector(d.classSelector(".slider-group"));this.indicator=this.element.querySelector(d.classSelector(".preview-indicator"));this.loader=this.element.querySelector(d.classSelector(".preview-loading"));if(k.footer){this.element.querySelector(d.classSelector(".preview-footer")).classList.remove(d.className("hidden"))}this.addImages()};e.initEvent=function(){var l=this;d(document.body).on("tap","img[data-preview-src]",function(){l.open(this);return false});var k=null;var m=function(){!k&&(k=d.later(function(){l.loader.removeEventListener("tap",m);l.scroller.removeEventListener("tap",m);l.close()},300))};this.scroller.addEventListener("doubletap",function(){if(k){k.cancel();k=null}});this.element.addEventListener("webkitAnimationEnd",function(){if(l.element.classList.contains(d.className("preview-out"))){l.element.style.display="none";l.element.classList.remove(d.className("preview-out"));l.element.classList.remove(d.className("preview-in"));k=null}else{l.loader.addEventListener("tap",m);l.scroller.addEventListener("tap",m)}});this.element.addEventListener("slide",function(p){if(l.options.zoom){var o=l.element.querySelector(".mui-zoom-wrapper:nth-child("+(l.lastIndex+1)+")");if(o){d(o).zoom().setZoom(1)}}var n=p.detail.slideNumber;l.lastIndex=n;l.indicator&&(l.indicator.innerText=(n+1)+"/"+l.currentGroup.length);l._loadItem(n)})};e.addImages=function(n,l){this.groups={};var o=[];if(n){if(n===f){o=document.querySelectorAll("img[data-preview-src]:not([data-preview-group])")}else{o=document.querySelectorAll("img[data-preview-src][data-preview-group='"+n+"']")}}else{o=document.querySelectorAll("img[data-preview-src]")}if(o.length){for(var m=0,k=o.length;m<k;m++){this.addImage(o[m])}}};e.addImage=function(l){var n=l.getAttribute("data-preview-group");n=n||f;if(!this.groups[n]){this.groups[n]=[]}var o=l.getAttribute("src");if(l.__mui_img_data&&l.__mui_img_data.src===o){this.groups[n].push(l.__mui_img_data)}else{var k=l.getAttribute("data-preview-src");if(!k){k=o}var m={src:o,lazyload:o===k?"":k,loaded:o===k?true:false,sWidth:0,sHeight:0,sTop:0,sLeft:0,sScale:1,el:l};this.groups[n].push(m);l.__mui_img_data=m}};e.empty=function(){this.scroller.innerHTML=""};e._initImgData=function(k,m){if(!k.sWidth){var l=k.el;k.sWidth=l.offsetWidth;k.sHeight=l.offsetHeight;var n=d.offset(l);k.sTop=n.top;k.sLeft=n.left;k.sScale=Math.max(k.sWidth/g.innerWidth,k.sHeight/g.innerHeight)}m.style.webkitTransform="translate3d(0,0,0) scale("+k.sScale+")"};e._getScale=function(o,n){var l=o.width/n.width;var k=o.height/n.height;var m=1;if(l<=k){m=o.height/(n.height*l)}else{m=o.width/(n.width*k)}return m};e._imgTransitionEnd=function(l){var k=l.target;k.classList.remove(d.className("transitioning"));k.removeEventListener("webkitTransitionEnd",this._imgTransitionEnd.bind(this))};e._loadItem=function(m,p){var o=this.scroller.querySelector(d.classSelector(".slider-item:nth-child("+(m+1)+")"));var k=this.currentGroup[m];var q=o.querySelector("img");this._initImgData(k,q);if(p){var n=this._getPosition(k);q.style.webkitTransitionDuration="0ms";q.style.webkitTransform="translate3d("+n.x+"px,"+n.y+"px,0) scale("+k.sScale+")";q.offsetHeight}if(!k.loaded&&q.getAttribute("data-preview-lazyload")){var l=this;l.loader.classList.add(d.className("active"));q.style.webkitTransitionDuration="0.5s";q.addEventListener("webkitTransitionEnd",l._imgTransitionEnd.bind(l));q.style.webkitTransform="translate3d(0,0,0) scale("+k.sScale+")";this.loadImage(q,function(){k.loaded=true;q.src=k.lazyload;l._initZoom(o,this.width,this.height);q.classList.add(d.className("transitioning"));q.addEventListener("webkitTransitionEnd",l._imgTransitionEnd.bind(l));q.setAttribute("style","");q.offsetHeight;l.loader.classList.remove(d.className("active"))})}else{k.lazyload&&(q.src=k.lazyload);this._initZoom(o,q.width,q.height);q.classList.add(d.className("transitioning"));q.addEventListener("webkitTransitionEnd",this._imgTransitionEnd.bind(this));q.setAttribute("style","");q.offsetHeight}this._preloadItem(m+1);this._preloadItem(m-1)};e._preloadItem=function(l){var m=this.scroller.querySelector(d.classSelector(".slider-item:nth-child("+(l+1)+")"));if(m){var k=this.currentGroup[l];if(!k.sWidth){var n=m.querySelector("img");this._initImgData(k,n)}}};e._initZoom=function(m,p,o){if(!this.options.zoom){return}if(m.getAttribute("data-zoomer")){return}var n=m.querySelector(d.classSelector(".zoom"));if(n.tagName==="IMG"){var l=this;var k=l._getScale({width:m.offsetWidth,height:m.offsetHeight},{width:p,height:o});d(m).zoom({maxZoom:Math.max(k,1)})}else{d(m).zoom()}};e.loadImage=function(m,n){var l=function(){n&&n.call(this)};var k=new Image();k.onload=l;k.onerror=l;k.src=m.getAttribute("data-preview-lazyload")};e.getRangeByIndex=function(k,l){return{from:0,to:l-1}};e._getPosition=function(l){var m=l.sLeft-g.pageXOffset;var k=l.sTop-g.pageYOffset;var o=(g.innerWidth-l.sWidth)/2;var n=(g.innerHeight-l.sHeight)/2;return{left:m,top:k,x:m-o,y:k-n}};e.refresh=function(r,x){this.currentGroup=x;var l=x.length;var o=[];var q=this.getRangeByIndex(r,l);var v=q.from;var w=q.to+1;var s=r;var t="";var y="";var n=g.innerWidth;var u=g.innerHeight;for(var p=0;v<w;v++,p++){var m=x[v];var k="";if(m.sWidth){k="-webkit-transform:translate3d(0,0,0) scale("+m.sScale+");transform:translate3d(0,0,0) scale("+m.sScale+")"}y=h.replace("{{src}}",m.src).replace("{{lazyload}}",m.lazyload).replace("{{style}}",k);if(v===r){s=p;t=d.className("active")}else{t=""}o.push(y.replace("{{className}}",t))}this.scroller.innerHTML=o.join("");this.element.style.display="block";this.element.classList.add(d.className("preview-in"));this.lastIndex=s;this.element.offsetHeight;d(this.element).slider().gotoItem(s,0);this.indicator&&(this.indicator.innerText=(s+1)+"/"+this.currentGroup.length);this._loadItem(s,true)};e.openByGroup=function(k,l){k=Math.min(Math.max(0,k),this.groups[l].length-1);this.refresh(k,this.groups[l])};e.open=function(k,l){if(this.isShown()){return}if(typeof k==="number"){l=l||f;this.addImages(l,k);this.openByGroup(k,l)}else{l=k.getAttribute("data-preview-group");l=l||f;this.addImages(l,k);this.openByGroup(this.groups[l].indexOf(k.__mui_img_data),l)}};e.close=function(q,u){if(!this.isShown()){return}this.element.classList.remove(d.className("preview-in"));this.element.classList.add(d.className("preview-out"));var s=this.scroller.querySelector(d.classSelector(".slider-item:nth-child("+(this.lastIndex+1)+")"));var k=s.querySelector("img");if(k){k.classList.add(d.className("transitioning"));var n=this.currentGroup[this.lastIndex];var m=this._getPosition(n);var r=m.left;var t=m.top;if(t>g.innerHeight||r>g.innerWidth||t<0||r<0){k.style.opacity=0;k.style.webkitTransitionDuration="0.5s";k.style.webkitTransform="scale("+n.sScale+")"}else{if(this.options.zoom){d(k.parentNode.parentNode).zoom().toggleZoom(0)}k.style.webkitTransitionDuration="0.5s";k.style.webkitTransform="translate3d("+m.x+"px,"+m.y+"px,0) scale("+n.sScale+")"}}var l=this.element.querySelectorAll(d.classSelector(".zoom-wrapper"));for(var o=0,p=l.length;o<p;o++){d(l[o]).zoom().destroy()}d(this.element).slider().destroy()};e.isShown=function(){return this.element.classList.contains(d.className("preview-in"))};var j=null;d.previewImage=function(k){if(!j){j=new b(k)}return j};d.getPreviewImage=function(){return j}})(mui,window);