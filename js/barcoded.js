var ws=null;var scan=null,domready=false,bCancel=false;function plusReady(){if(ws||!window.plus||!domready){return}ws=plus.webview.currentWebview();ws.addEventListener("show",function(){scan=new plus.barcode.Barcode("bcid",[plus.barcode.QR,plus.barcode.EAN8,plus.barcode.EAN13],{frameColor:"#F59703",scanbarColor:"#F59703"});scan.onmarked=onmarked;scan.start({conserve:true,filename:"_doc/barcode/"})})}if(window.plus){plusReady()}else{document.addEventListener("plusready",plusReady,false)}document.addEventListener("DOMContentLoaded",function(){domready=true;plusReady()},false);function onmarked(f,a,d){switch(f){case plus.barcode.QR:f="QR";break;case plus.barcode.EAN13:f="EAN13";break;case plus.barcode.EAN8:f="EAN8";break;default:f="其它"+f;break}a=a.replace(/\n/g,"");if(a!=""){var c=localStorage.getItem("CAYICA_TOKEN");var b="www.cayica.com/client/ddcayica";if(c){if(~a.indexOf("http")&&~a.indexOf("uid")){plus.webview.currentWebview().close("pop-out");mui.toast("您已注册")}else{if(~a.toLowerCase().indexOf(b.toLowerCase())){plus.runtime.openURL(a);scan.cancel();btCancel&&(btCancel.innerText="开　始")}else{plus.webview.currentWebview().close("pop-out");mui.toast(a)}}}else{if(~a.indexOf("http")&&~a.indexOf("uid")){var e=a.split("=")[1];mui.openWindow({url:"../reg.html",id:"reg.html",show:{duration:250,aniShow:"pop-in"},waiting:{autoShow:false},extras:{TuiJianRen:e}});setTimeout(function(){var g=plus.webview.currentWebview();g.close("none",0)},1000)}else{if(~a.toLowerCase().indexOf(b.toLowerCase())){plus.runtime.openURL(a);scan.cancel();btCancel&&(btCancel.innerText="开　始")}else{setTimeout(function(){plus.webview.currentWebview().close("pop-out")},100);mui.toast(a)}}}}else{setTimeout(function(){plus.webview.currentWebview().close("pop-out")},100)}}function scanSwitch(){if(bCancel){scan.start({conserve:true,filename:"_doc/barcode/"});btCancel&&(btCancel.innerText="暂　停")}else{scan.cancel();btCancel&&(btCancel.innerText="开　始")}bCancel=!bCancel}var back=function(){if(window.plus){plus.webview.currentWebview().close("pop-out")}};