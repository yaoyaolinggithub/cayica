var ui={container1:sui.gel("container1"),container2:sui.gel("container2"),IsRefund:0,index1:1,index2:1,w:null,elem:null,container:null,index:1,Arr:sui.gel("sliderSegmentedControl").querySelectorAll("a"),navbox:sui.gel("navbox"),checkAll:sui.gel("checkAll"),btnRepay:sui.gel("btnRepay"),totalPrice:sui.gel("totalPrice"),pullrefresh:sui.gel("pullrefresh"),isrefresh1:false,isrefresh2:false,loopPullDown:null,AvailBal:sui.gel("AvailBal"),yuE:0,switchbox:sui.gel("switchbox"),yuebox:sui.gel("yuebox"),toggle:sui.gel("toggle")};var disabledTap=function(){mui.each(ui.Arr,function(a,b){b.classList.add("mui-disabled")})};var recoverTap=function(){mui.each(ui.Arr,function(a,b){b.classList.remove("mui-disabled")})};(function(a){a.init({pullRefresh:{container:"#pullrefresh",down:{callback:pulldownRefresh},up:{callback:pullupRefresh}}});a.plusReady(function(){ui.container=ui.container1;setTimeout(function(){a("#pullrefresh").pullRefresh().pullupLoading()},180)})})(mui);var template1=function(a){var c="none";if(a.IsOverdue==2){c="yellow"}else{if(a.IsOverdue==3){c="red"}}var b=['<div class="mui-checkbox  w10"><input name="checkbox" type="checkbox" class="sui-checkbox" value="'+a.AllAmount+'" data="'+a.PlanDate+'"/> </div>','<div class="w90"><span class="'+c+'">'+a.PlanDate+"</span><span>¥"+sui.rmoney(a.AllAmount)+"</span>",'<span  class="blue" data="detail" data-v="'+a.PlanDate+'">查看<a class="mui-icon iconfont icon-youjiantou"></a></span></div>'].join("");return b};var template2=function(a){var b="<span>"+a.PlanDate+"</span> <span>¥"+sui.rmoney(a.AllAmount)+'</span><span class="blue" data="detail" data-v="'+a.PlanDate+'">查看<a class="mui-icon iconfont icon-youjiantou"></a></span>';return b};function pulldownRefresh(){disabledTap();var a={container:ui.container,IsRefund:ui.IsRefund};clearTimeout(ui.loopPullDown);setTimeout(function(){sui.request("Order/RefundList",{IsRefund:a.IsRefund,pageIndex:1},true,function(h){if(h){var g=h.IsPass;if(g){var f=h.ReturnObject.RefundList.length;ui.yuE=h.ReturnObject.YuE||0;a.container.innerHTML="";if(f>0){ui.elem=sui.rtips(ui.elem);ui.yuebox.innerText=sui.rmoney(ui.yuE);var d=sui.fragment();if(a.IsRefund){var c=document.createElement("li");c.className="mui-table-view-cell";c.innerHTML="<span>还款日期</span><span>还款金额</span><span>还款详情</span>";d.appendChild(c)}else{var c=document.createElement("li");c.className="mui-table-view-cell pad12";c.innerHTML='<div class="w10 mui-left"> </div> <div  class="w90"><span>还款日期</span><span>还款金额</span><span>还款详情</span></div>';d.appendChild(c)}for(var e=0;e<f;e++){var b={PlanDate:sui.formatDate("y-m-d",h.ReturnObject.RefundList[e].PlanDate),AllAmount:h.ReturnObject.RefundList[e].AllAmount,IsOverdue:h.ReturnObject.RefundList[e].IsOverdue};var c=document.createElement("li");c.className="mui-table-view-cell";c.innerHTML=a.IsRefund?template2(b):template1(b);d.appendChild(c)}a.container.appendChild(d);a.container.classList.remove("mui-hidden");if(a.IsRefund){ui.index2=2;ui.index=ui.index2;navShow(a.IsRefund)}else{ui.index1=2;ui.index=ui.index1;navShow(a.IsRefund)}mui("#pullrefresh").pullRefresh().endPulldownToRefresh();ui.loopPullDown=setTimeout(function(){mui("#pullrefresh").pullRefresh().enablePullupToRefresh();mui("#pullrefresh").pullRefresh().refresh(true)},1000);computedPrice()}else{if(a.IsRefund){ui.index2=1;ui.index=ui.index2;navShow(a.IsRefund)}else{ui.index1=1;ui.index=ui.index1;navShow(a.IsRefund)}a.container.classList.add("mui-hidden");mui("#pullrefresh").pullRefresh().endPulldownToRefresh();mui("#pullrefresh").pullRefresh().disablePullupToRefresh();if(!ui.elem){ui.elem=sui.ctips("comiiszanwushuju","暂无相关数据")}}}else{mui("#pullrefresh").pullRefresh().endPulldownToRefresh();mui.toast(h.Desc)}recoverTap()}else{mui("#pullrefresh").pullRefresh().endPulldownToRefresh();mui.toast("无法连接到服务器，请检查网络是否连接！");recoverTap()}})},400)}function pullupRefresh(){disabledTap();var a={container:ui.container,IsRefund:ui.IsRefund,index:ui.index};setTimeout(function(){sui.request("Order/RefundList",{IsRefund:a.IsRefund,pageIndex:a.index},true,function(h){if(h){var g=h.IsPass;if(g){var f=h.ReturnObject.RefundList.length;if(f>0){ui.elem=sui.rtips(ui.elem);ui.yuE=h.ReturnObject.YuE||0;ui.yuebox.innerText=sui.rmoney(ui.yuE);var d=sui.fragment();if(ui.index==1){if(a.IsRefund){var c=document.createElement("li");c.className="mui-table-view-cell";c.innerHTML="<span>还款日期</span><span>还款金额</span><span>还款详情</span>";d.appendChild(c)}else{var c=document.createElement("li");c.className="mui-table-view-cell pad12";c.innerHTML='<div class="w10 mui-left"> </div> <div  class="w90"><span>还款日期</span><span>还款金额</span><span>还款详情</span></div>';d.appendChild(c)}}for(var e=0;e<f;e++){var b={PlanDate:sui.formatDate("y-m-d",h.ReturnObject.RefundList[e].PlanDate),AllAmount:h.ReturnObject.RefundList[e].AllAmount,IsOverdue:h.ReturnObject.RefundList[e].IsOverdue};var c=document.createElement("li");c.className="mui-table-view-cell";c.innerHTML=a.IsRefund?template2(b):template1(b);d.appendChild(c)}a.container.appendChild(d);if(a.index==1){a.container.classList.remove("mui-hidden")}if(a.IsRefund){ui.index2++;ui.index=ui.index2;navShow(a.IsRefund)}else{ui.index1++;ui.index=ui.index1;navShow(a.IsRefund)}mui("#pullrefresh").pullRefresh().endPullupToRefresh(false);computedPrice()}else{if(ui.index==1){mui("#pullrefresh").pullRefresh().endPullupToRefresh(true);mui("#pullrefresh").pullRefresh().disablePullupToRefresh();if(!ui.elem){ui.elem=sui.ctips("comiiszanwushuju","暂无相关数据")}}else{mui("#pullrefresh").pullRefresh().endPullupToRefresh(true)}}}else{mui.toast(h.Desc);mui("#pullrefresh").pullRefresh().endPullupToRefresh(false)}recoverTap()}else{mui.toast("无法连接到服务器，请检查网络是否连接！");mui("#pullrefresh").pullRefresh().endPullupToRefresh(false);recoverTap()}})},400)}var tapRefresh=function(a){if(ui.index==1){setTimeout(function(){mui("#pullrefresh").pullRefresh().disablePullupToRefresh();mui("#pullrefresh").pullRefresh().pulldownLoading()},100)}else{if(a){setTimeout(function(){mui("#pullrefresh").pullRefresh().pulldownLoading();if(ui.IsRefund){ui.isrefresh2=false}else{ui.isrefresh1=false}},100)}else{mui("#pullrefresh").pullRefresh().enablePullupToRefresh()}}};var navShow=function(a){if(!a){var b=ui.container1.querySelectorAll('input[type="checkbox"]').length;if(b){if(ui.yuE>0){ui.navbox.style.height="92px";ui.pullrefresh.style.paddingBottom="92px";ui.switchbox.classList.remove("mui-hidden")}else{ui.navbox.style.height="50px";ui.pullrefresh.style.paddingBottom="50px";ui.switchbox.classList.add("mui-hidden")}ui.navbox.classList.remove("mui-hidden")}else{ui.navbox.classList.add("mui-hidden");ui.pullrefresh.style.paddingBottom="0px"}}else{ui.navbox.classList.add("mui-hidden");ui.pullrefresh.style.paddingBottom="0px"}};var PayOrder=function(a,b){ui.w=sui.wait("请稍候...");sui.post("Order/RefundPay",{dt:a,IsYuEPay:b},function(e){if(e){var d=e.IsPass;if(d){var c={PayWaterId:e.ReturnObject.PayWaterId,Amount:e.ReturnObject.Amount,PayTitle:e.ReturnObject.PayTitle,IsNeedPay:e.ReturnObject.IsNeedPay};if(c.IsNeedPay){sui.open("../orderProcess/orderPay.html","orderPay.html",{PayWaterId:c.PayWaterId,Amount:c.Amount,PayTitle:c.PayTitle,payType:3})}else{mui.toast("还款成功");beforeRefresh()}sui.closewait(ui.w)}else{mui.toast(e.Desc);sui.closewait(ui.w)}}else{mui.toast("无法连接到服务器，请检查网络是否连接");sui.closewait(ui.w)}})};mui("#sliderSegmentedControl").on("tap","a[data=tap]",function(){var b=this;if(~b.className.indexOf("mui-active")){mui("#pullrefresh").pullRefresh().scrollTo(0,0,200);return}var a=b.id;ui.elem=sui.rtips(ui.elem);if(mui.os.ios){mui("#pullrefresh").pullRefresh().scrollTo(0,0,0)}else{mui("#pullrefresh").pullRefresh().scrollTo(0,0,100)}if(a=="panelTitle1"){ui.IsRefund=0;ui.container=ui.container1;ui.index=ui.index1;navShow(ui.IsRefund);tapRefresh(ui.isrefresh1)}else{if(a=="panelTitle2"){ui.IsRefund=1;ui.container=ui.container2;ui.index=ui.index2;navShow(ui.IsRefund);tapRefresh(ui.isrefresh2)}}});function beforeRefresh(){ui.isrefresh1=true;ui.isrefresh2=true;mui("#pullrefresh").pullRefresh().pulldownLoading()}var computedPrice=function(){var b=ui.container1.querySelectorAll('input[type="checkbox"]').length;var d=ui.container1.querySelectorAll('input[type="checkbox"]:checked').length;if(d){if(b==d){ui.checkAll.checked=true}else{ui.checkAll.checked=false}var e=[].slice.call(ui.container1.querySelectorAll('input[type="checkbox"]:checked'));var a=0;e.forEach(function(h,f){var g=parseFloat(h.value);a+=g});if(ui.yuE>0&&ui.toggle.classList.contains("mui-active")){var c=a-ui.yuE;ui.AvailBal.innerText=c>0?("余额：-¥"+sui.rmoney(ui.yuE)):("余额：-¥"+sui.rmoney(a));a=c>0?c:0;ui.totalPrice.classList.remove("mtop");ui.AvailBal.classList.remove("mui-hidden")}else{ui.AvailBal.classList.add("mui-hidden");ui.totalPrice.classList.add("mtop")}ui.totalPrice.innerText="合计：¥"+sui.rmoney(a)}else{ui.AvailBal.classList.add("mui-hidden");ui.totalPrice.classList.add("mtop");ui.checkAll.checked=false;ui.totalPrice.innerText="合计：¥0.00"}};var selectAll=function(a){var b=[].slice.call(ui.container1.querySelectorAll('input[type="checkbox"]'));if(a){b.forEach(function(d,c){d.checked=true});computedPrice()}else{b.forEach(function(d,c){d.checked=false});ui.AvailBal.classList.add("mui-hidden");ui.totalPrice.classList.add("mtop");ui.totalPrice.innerText="合计：¥0.00"}};mui(ui.navbox).on("change","input[type=checkbox]",function(){var a=this;if(a.checked){selectAll(true)}else{selectAll(false)}});mui(ui.container1).on("change","input[type=checkbox]",function(){setTimeout(function(){computedPrice()},200)});mui(ui.navbox).on("toggle","#toggle",function(a){computedPrice()});ui.btnRepay.addEventListener("tap",function(){var d=ui.container1.querySelectorAll('input[type="checkbox"]:checked');var b=d.length;if(b){var e="";for(var a=0;a<b;a++){e+=d[a].getAttribute("data")+"^"}e=e.substring(0,e.length-1);var c=ui.toggle.classList.contains("mui-active")?1:0;PayOrder(e,c)}else{mui.toast("请选择还款日期进行还款")}});mui(ui.container1).on("tap","span[data=detail]",function(){var a=this.getAttribute("data-v");sui.open("repaymentDetail.html","repaymentDetail.html",{repayDate:a,IsRefund:0})});mui(ui.container2).on("tap","span[data=detail]",function(){var a=this.getAttribute("data-v");sui.open("repaymentDetail.html","repaymentDetail.html",{repayDate:a,IsRefund:1})});