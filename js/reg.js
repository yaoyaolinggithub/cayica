var ui={txtMobile:sui.gel("txtMobile"),txtYzm:sui.gel("txtYzm"),txtPwd:sui.gel("txtPwd"),btnSend:sui.gel("btnSend"),btnSure:sui.gel("btnSure"),w:null,isSend:0,channel:2,userAgree:sui.gel("userAgree"),btnAgree:sui.gel("btnAgree"),agree:true,TuiJianRen:"",};(function(a){a.plusReady(function(){var e=plus.webview.currentWebview();ui.TuiJianRen=e.TuiJianRen||"";ui.channel=plus.os.name=="Android"?2:3;ui.btnSend.addEventListener("tap",function(){var f=ui.txtMobile.value.trim();if(!ui.agree){a.toast("请阅读并同意《擦一擦注册服务协议》");return}else{if(sui.IsNullOrEmpty(f)){a.toast("请输入手机号");return}else{if(!f.isMobile()){a.toast("请输入正确的手机号码");return}}}ui.isSend=0;ui.btnSend.innerText="请稍候...";ui.btnSend.setAttribute("disabled","disabled");sui.request("Passport/GetTime",{},true,function(h){if(h){var g=h.IsPass;if(g){b(h.ReturnObject,f)}else{a.toast("获取验证码失败,请稍候再试");ui.btnSend.removeAttribute("disabled");ui.btnSend.innerText="获取验证码"}}else{a.toast("获取验证码失败，请检查网络是否连接");ui.btnSend.removeAttribute("disabled");ui.btnSend.innerText="获取验证码"}})});var d=function(g){if(g!=null){var h,f;f=/\d*/i;h=g.match(f);return(h==g)?true:false}return false};var c=function(m){hash=hex_md5(m);var g="000000";var h=0;for(var l=hash.length;l>0;l--){var k=0;var f=hash.substring(l-1,l);if(d(f)){h++;if(h==7){break}var k=9-parseInt(f);g=g+k.toString()}}g=g.substring(g.length-6,g.length);return g};var b=function(g,h){g=c(g)+g;var f={Mobile:h,ImageCode:g,Channel:ui.channel};sui.request("Passport/GetPhoneCode",f,false,function(l){if(l){var k=l.IsPass;if(k){ui.isSend=1;ui.txtMobile.setAttribute("disabled","disabled");var j=180;function i(){if(j>=0){ui.btnSend.innerText=j+"s";--j}else{clearInterval(InTime);ui.btnSend.innerText="获取验证码";ui.btnSend.removeAttribute("disabled")}}InTime=setInterval(i,1000)}else{ui.btnSend.innerText="获取验证码";ui.btnSend.removeAttribute("disabled");a.toast(l.Desc)}}else{ui.btnSend.removeAttribute("disabled");ui.btnSend.innerText="获取验证码";a.toast("发送失败,请检查网络是否连接")}})};ui.btnSure.addEventListener("tap",function(){var h=ui.txtMobile.value.trim();var i=ui.txtPwd.value.trim();var g=ui.txtYzm.value.trim();if(!ui.agree){a.toast("请阅读并同意《擦一擦注册服务协议》");return}else{if(!ui.isSend){a.toast("请获取手机验证码");return}else{if(sui.IsNullOrEmpty(h)){a.toast("请输入手机号");return}else{if(!h.isMobile()){a.toast("请输入正确的手机号");return}else{if(sui.IsNullOrEmpty(g)){a.toast("请输入验证码");return}else{if(sui.IsNullOrEmpty(i)){a.toast("请输入密码");return}}}}}}ui.w=sui.wait("正在注册...");var f={Mobile:h,Password:i,Code:g,Channel:ui.channel,TuiJianRen:ui.TuiJianRen};sui.request("Passport/Reg",f,false,function(l){if(l){var k=l.IsPass;if(k){sui.setToken(l.ReturnObject.Token);sui.closewait(ui.w);var j=l.ReturnObject.HasTuiJianRen;if(j==1){sui.open("help/regSs.html","regSs.html",{})}else{sui.open("recommend.html","recommend.html",null)}setTimeout(function(){var m=plus.webview.currentWebview();m.close("none",0)},500)}else{sui.closewait(ui.w);a.toast(l.Desc);ui.txtMobile.removeAttribute("disabled")}}else{sui.closewait(ui.w);ui.txtMobile.removeAttribute("disabled");a.toast("注册失败，请检查网络是否连接")}})})})})(mui);ui.userAgree.addEventListener("tap",function(){sui.open("help/regAgree.html","regAgree.html",{})});ui.btnAgree.addEventListener("tap",function(){var a=this;if(ui.agree){a.classList.remove("color");ui.agree=false}else{a.classList.add("color");ui.agree=true}});