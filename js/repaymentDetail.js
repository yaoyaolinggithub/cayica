var ui={navbox:sui.gel("navbox"),btnRepay:sui.gel("btnRepay"),container:sui.gel("container"),w:null,repayDate:null,checkAll:sui.gel("checkAll"),checkBox:sui.gel("checkBox"),pricebox:sui.gel("pricebox"),totalPrice:sui.gel("totalPrice"),AvailBal:sui.gel("AvailBal"),yuE:0,allAmount:0};(function(a){if(a.os.ios){ui.container.classList.add("ios-scroll-bounce")}a.plusReady(function(){var c=plus.webview.currentWebview();ui.repayDate=c.repayDate;var b=c.IsRefund;setTimeout(function(){ui.w=sui.wait("正在加载...");sui.request("Order/RefundDetail",{dt:ui.repayDate,IsRefund:b},true,function(k){if(k){var j=k.IsPass;if(j){var e={PlanDateStr:k.ReturnObject.PlanDateStr,RefundDateStr:k.ReturnObject.RefundDateStr,DetailList:k.ReturnObject.DetailList,IsRefund:k.ReturnObject.IsRefund,UseYuE:k.ReturnObject.UseYuE||0};ui.allAmount=k.ReturnObject.AllAmount||0;ui.yuE=k.ReturnObject.YuE||0;var h=(e.IsRefund!=1&&e.UseYuE>0)?true:false;var f=['<div class="firstChild"><div class="relative '+(h?"wid3":"")+'" >'];if(e.IsRefund==1){f.push('<span class="title">已还款总额</span>')}else{f.push('<span class="title">当前还款总额</span>')}f.push('<p class="right-p" data="total">¥'+sui.rmoney(ui.allAmount)+"</p></div>");if(h){f.push('<div class="relative wid3"><span class="title">余额已抵扣</span><p class="right-p2" data="total">￥'+sui.rmoney(e.UseYuE)+"</p></div>")}f.push('<div class="'+(h?"wid3":"")+'">');if(e.IsRefund==1){f.push('<span class="title">还款日期</span><p class="right-p">'+e.RefundDateStr+"</p>")}else{f.push('<span class="title">到期日</span><p class="right-p">'+e.PlanDateStr+"</p>")}f.push('</div></div><ul class="mui-table-view"><li class="mui-table-view-cell white"><span>订单号</span><span>当前期数</span><span>还款金额</span></li>');var d=e.DetailList.length;for(var g=0;g<d;g++){f.push('<li class="mui-table-view-cell" data="detail" data-v="'+e.DetailList[g].OrderId+'"><span>'+e.DetailList[g].OrderCode+"</span><span>"+(e.DetailList[g].ThisTimes+"/"+e.DetailList[g].AllTimes)+"</span><span>¥"+sui.rmoney(e.DetailList[g].Amount)+"</span></li>")}f.push("</ul>");ui.container.innerHTML=f.join("");ui.container.classList.remove("mui-hidden");if(e.IsRefund!=1){if(ui.yuE>0){ui.totalPrice.innerText="¥"+sui.rmoney(ui.yuE);ui.checkBox.classList.remove("mui-hidden");ui.pricebox.classList.remove("mui-hidden")}else{ui.btnRepay.classList.add("wid100")}ui.navbox.classList.remove("mui-hidden");ui.container.style.paddingBottom="50px"}sui.closewait(ui.w)}else{mui.toast(k.Desc);sui.closewait(ui.w)}}else{mui.toast("无法连接到服务器，请检查网络是否连接！");sui.closewait(ui.w)}})},250)})})(mui);mui(ui.container).on("tap","li[data=detail]",function(){var a=this.getAttribute("data-v");sui.open("../orderProcess/orderDetail.html","orderDetail.html",{orderId:a})});var PayOrder=function(a,b){ui.w=sui.wait("请稍候...");sui.post("Order/RefundPay",{dt:a,IsYuEPay:b},function(g){if(g){var e=g.IsPass;if(e){var c={PayWaterId:g.ReturnObject.PayWaterId,Amount:g.ReturnObject.Amount,PayTitle:g.ReturnObject.PayTitle,IsNeedPay:g.ReturnObject.IsNeedPay};if(c.IsNeedPay){sui.open("../orderProcess/orderPay.html","orderPay.html",{PayWaterId:c.PayWaterId,Amount:c.Amount,PayTitle:c.PayTitle,payType:3});setTimeout(function(){plus.webview.currentWebview().close("none",0)},500)}else{mui.toast("还款成功");var f=plus.webview.currentWebview();var d=f.opener();if(d){d.evalJS("beforeRefresh();")}setTimeout(function(){f.close()},150)}sui.closewait(ui.w)}else{mui.toast(g.Desc);sui.closewait(ui.w)}}else{mui.toast("无法连接到服务器，请检查网络是否连接");sui.closewait(ui.w)}})};ui.btnRepay.addEventListener("tap",function(){var a=(ui.yuE&&ui.checkAll.checked)?1:0;PayOrder(ui.repayDate,a)});mui(ui.navbox).on("change","input[type=checkbox]",function(){var b=this;var a=ui.allAmount-ui.yuE;if(b.checked){ui.AvailBal.innerText=a>0?("-¥"+sui.rmoney(ui.yuE)):("-¥"+sui.rmoney(ui.allAmount));document.querySelector("p[data=total]").innerText="¥"+sui.rmoney(a>0?a:0);ui.totalPrice.classList.remove("mtop");ui.AvailBal.classList.remove("mui-hidden")}else{ui.AvailBal.classList.add("mui-hidden");ui.totalPrice.classList.add("mtop");document.querySelector("p[data=total]").innerText="¥"+sui.rmoney(ui.allAmount)}});