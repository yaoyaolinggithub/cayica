var ui={w:null,nav:sui.gel("nav"),btnOperater:sui.gel("btnOperater"),btnCancle:sui.gel("btnCancle"),container:sui.gel("container"),restoreId:"",RecycleCode:"",state:3};function detail(){sui.request("Order/GetRestore",{restoreId:ui.restoreId},true,function(u){if(u){var v=u.IsPass;if(v){var d={icon:"",word:"",goods:u.ReturnObject.MyRestoreDetail,sbHtml:"",hsHtml:"",wcHtml:""};var n=[];ui.state=u.ReturnObject.MyRecycle.State;switch(ui.state){case 0:d.icon="gantanhao";d.word="已关闭";ui.btnCancle.classList.add("mui-hidden");ui.btnOperater.innerText="删除归还单";ui.btnOperater.classList.remove("mui-hidden");ui.nav.classList.remove("mui-hidden");break;case 1:d.icon="gantanhao";d.word="已取消";ui.btnCancle.classList.add("mui-hidden");ui.btnOperater.innerText="删除归还单";ui.btnOperater.classList.remove("mui-hidden");ui.nav.classList.remove("mui-hidden");break;case 2:d.icon="dengdai";d.word="待付租金";ui.btnOperater.innerText="立即支付";ui.btnCancle.classList.remove("mui-hidden");ui.nav.classList.remove("mui-hidden");break;case 3:d.icon="dengdai";d.word="待派单";ui.btnOperater.classList.add("mui-hidden");ui.btnCancle.classList.remove("mui-hidden");ui.nav.classList.remove("mui-hidden");break;case 4:ui.nav.classList.add("mui-hidden");d.icon="huishouzhan01";d.word="待回收";d.hsHtml='<div class="item2-tit top6"> <span class="mui-ellipsis"> <label>回收人信息</label>'+u.ReturnObject.MyRecycle.HuiShouUser+"  "+u.ReturnObject.MyRecycle.HuiShouPhone+"</span>";d.hsHtml+=' <span class="top5"><label>收货时间</label>'+sui.formatDate("y-m-d h:i:s",u.ReturnObject.MyRecycle.ComeDate)+"  "+u.ReturnObject.MyRecycle.ComeTime+"</span></div>";break;case 5:ui.nav.classList.add("mui-hidden");d.icon="huishouzhan01";d.word="待审核";d.hsHtml='<div class="item2-tit top6"> <span class="mui-ellipsis"> <label>回收人信息</label>'+u.ReturnObject.MyRecycle.HuiShouUser+"  "+u.ReturnObject.MyRecycle.HuiShouPhone+"</span>";d.hsHtml+=' <span class="top5"><label>收货时间</label>'+sui.formatDate("y-m-d h:i:s",u.ReturnObject.MyRecycle.ComeDate)+"  "+u.ReturnObject.MyRecycle.ComeTime+"</span></div>";break;case 6:ui.nav.classList.remove("mui-hidden");d.icon="gantanhao";d.word="已拒绝";d.hsHtml='<div class="item2-tit top6"> <span class="mui-ellipsis"> <label>回收人信息</label>'+u.ReturnObject.MyRecycle.HuiShouUser+"  "+u.ReturnObject.MyRecycle.HuiShouPhone+"</span>";d.hsHtml+=' <span class="top5"><label>收货时间</label>'+sui.formatDate("y-m-d h:i:s",u.ReturnObject.MyRecycle.ComeDate)+"  "+u.ReturnObject.MyRecycle.ComeTime+"</span></div>";break;case 7:ui.nav.classList.remove("mui-hidden");d.icon="huishouzhan01";d.word="待入库";d.hsHtml='<div class="item2-tit top6"> <span class="mui-ellipsis"> <label>回收人信息</label>'+u.ReturnObject.MyRecycle.HuiShouUser+"  "+u.ReturnObject.MyRecycle.HuiShouPhone+"</span>";d.hsHtml+=' <span class="top5"><label>收货时间</label>'+sui.formatDate("y-m-d h:i:s",u.ReturnObject.MyRecycle.ComeDate)+"  "+u.ReturnObject.MyRecycle.ComeTime+"</span></div>";break;case 8:ui.nav.classList.remove("mui-hidden");d.icon="fanhui1";d.word="已完成";d.hsHtml='<div class="item2-tit top6"> <span class="mui-ellipsis"> <label>回收人信息</label>'+u.ReturnObject.MyRecycle.HuiShouUser+"  "+u.ReturnObject.MyRecycle.HuiShouPhone+"</span>";d.hsHtml+=' <span class="top5"><label>收货时间</label>'+sui.formatDate("y-m-d h:i:s",u.ReturnObject.MyRecycle.ComeDate)+"  "+u.ReturnObject.MyRecycle.ComeTime+"</span></div>";d.wcHtml=['<ul class="mui-table-view  top6 view"><li class="mui-table-view-cell">合计</li><li class="mui-table-view-cell">押金总额','<span class="mui-pull-right">¥'+sui.rmoney(u.ReturnObject.MyRecycle.Deposit)+"</span>",'<div class="top5">租金总额<span class="mui-pull-right">¥'+sui.rmoney(u.ReturnObject.MyRecycle.Rent)+"</span> </div>",'<div class="top5">已补交租金<span class="mui-pull-right">¥'+sui.rmoney(u.ReturnObject.MyRecycle.BuJiaoRent)+"</span> </div>",'<div class="top5">破损费<span class="mui-pull-right">¥'+sui.rmoney(u.ReturnObject.MyRecycle.DamagedFee)+"</span> </div>",'<div class="top5">拆卸费<span class="mui-pull-right">¥'+sui.rmoney(u.ReturnObject.MyRecycle.ChaiXieFee)+"</span> </div>",'<div class="top5">运费<span class="mui-pull-right">¥'+sui.rmoney(u.ReturnObject.MyRecycle.YunFee)+"</span> </div>",'<div class="top5">退还金额<span class="mui-pull-right">¥'+sui.rmoney(u.ReturnObject.MyRecycle.ReturnAmount)+"</span> </div></li></ul>"].join("");break;default:break}var o=d.goods.length;for(var l=0;l<o;l++){var a=sui.unique(6);n.push({id:a,imgurl:d.goods[l].CoverImage});var q=JSON.parse(d.goods[l].SkuAttribute||"[]");var s=q.length;var r="";for(var h=0;h<s;h++){if(h==3){break}r+='<span class="guige">'+q[h].AttrName+"："+q[h].AttrVal+" </span>"}var e=d.goods[l].TermUnit;var c=d.goods[l].HireTerm;var b="";switch(e){case 1:b=c+"天";break;case 2:b=c+"个月";break;case 3:b=c+"季";break;case 4:b=c+"年";break;default:break}var k="";if(ui.state==8){k=" <span>破损费：¥"+sui.rmoney(d.goods[l].DamagedFee)+"</span> <span >拆装费：¥"+sui.rmoney(d.goods[l].ChaiXieFee)+"</span><span>补交租金：¥"+sui.rmoney(d.goods[l].BuJiaoRent)+"</span>";k+="<span>运费：¥"+sui.rmoney(d.goods[l].YunFee)+"</span><span>退还金额：¥"+sui.rmoney(d.goods[l].ReturnAmount)+"</span>"}var p=['<li class="mui-table-view-cell" data="detail" data-v="'+d.goods[l].ProductSkuId+'" ><img src="../images/hand.png"  id="'+a+'"/>','<div class="order_tit"><div class="mui-ellipsis-2 tit" >'+d.goods[l].ProductName+"</div>",'<div class="top5">'+r+'</div> </div><span class="mui-badge ">×'+d.goods[l].BuyNum+"</span>",'<div class="p-box"> <span> 押金：¥'+sui.rmoney(d.goods[l].Deposit)+"</span>","<span >租金：¥"+sui.rmoney(d.goods[l].Rent)+"</span><span>租期："+b+"</span>",k+"</div></li>",].join("");d.sbHtml+=p}ui.RecycleCode=u.ReturnObject.MyRecycle.RecycleCode;var t=['<div class="item1-tit"><span class="mui-icon iconfont icon-'+d.icon+'"></span><span class="word">'+d.word+"</span></div>",'<ul class="mui-table-view top6 white" data="wuliu"><li class="mui-table-view-cell"><a class="mui-navigate-right"><span class="mui-icon iconfont icon-daishouhuo"></span>感谢您在擦一擦租赁商品，欢迎您再次光临</a></li></ul>','<div class="item1-tit top6"> <span class="mui-ellipsis">归还单号：'+ui.RecycleCode+"</span> </div>",'<div class="item1-tit mui-table-view"><span class="mui-ellipsis">申请时间：'+sui.formatDate("y-m-d h:i:s",u.ReturnObject.MyRecycle.ApplyTime)+"</span> </div>",'<ul class="mui-table-view list">'+d.sbHtml+"</ul>",'<div class="item2-tit top6"><span class="mui-ellipsis"> <label>归还总数</label>'+u.ReturnObject.MyRecycle.RecycleNum+"件</span></div>",'<div class="item2-tit top6"> <span class="mui-ellipsis"> <label>联系人信息</label>'+u.ReturnObject.MyRecycle.ContactPerson+"  "+u.ReturnObject.MyRecycle.ContactPhone+"</span>",'<span class="top5 left">'+u.ReturnObject.MyRecycle.QuHuoAreaName+u.ReturnObject.MyRecycle.QuHuoAddress+"</span>",'<span class="top5"><label>预约时间</label>'+sui.formatDate("y-m-d",u.ReturnObject.MyRecycle.QuHuoDate)+"  "+u.ReturnObject.MyRecycle.QuHuoTime+"</span> </div>",d.hsHtml+d.wcHtml].join("");ui.container.innerHTML=t;sui.closewait(ui.w);var g=n.length;for(var f=0;f<g;f++){cache.setImg(n[f].id,n[f].imgurl)}}else{mui.toast(u.Desc);sui.closewait(ui.w)}}else{mui.toast("无法连接到服务器，请检查网络是否连接！");sui.closewait(ui.w)}})}(function(a){if(a.os.ios){ui.container.classList.add("ios-scroll-bounce")}a.plusReady(function(){var b=plus.webview.currentWebview();ui.restoreId=b.RecycleId;setTimeout(function(){ui.w=sui.wait("正在加载...");detail()},250)})})(mui);var PayOrder=function(a){ui.w=sui.wait("请稍候...");sui.post("Order/PayOrder",{orderIds:a,orderType:1},function(e){if(e){var d=e.IsPass;if(d){var b={PayWaterId:e.ReturnObject.PayWaterId,Amount:e.ReturnObject.Amount,PayTitle:e.ReturnObject.PayTitle,IsNeedPay:e.ReturnObject.IsNeedPay};if(b.IsNeedPay){sui.closewait(ui.w);sui.open("orderPay.html","orderPay.html",{PayWaterId:b.PayWaterId,Amount:b.Amount,PayTitle:b.PayTitle,payType:2})}else{mui.toast("付款成功");detail();var c=plus.webview.getWebviewById("orderRecover.html");if(c){c.evalJS("beforeRefresh();")}}}else{mui.toast(e.Desc);sui.closewait(ui.w)}}else{mui.toast("无法连接到服务器，请检查网络是否连接");sui.closewait(ui.w)}})};ui.btnCancle.addEventListener("tap",function(){var a=[{title:"确认",style:"destructive"}];plus.nativeUI.actionSheet({title:"确认要取消归还吗?",cancel:"取消",buttons:a},function(b){if(b.index==1){ui.w=sui.wait("请稍候...");sui.post("Order/CancelRestore",{restoreId:ui.restoreId},function(e){if(e){var d=e.IsPass;if(d){mui.toast("取消归还成功");detail();var c=plus.webview.getWebviewById("orderRecover.html");if(c){c.evalJS("beforeRefresh();")}}else{mui.toast(e.Desc);sui.closewait(ui.w)}}else{mui.toast("无法连接到服务器，请检查网络是否连接");sui.closewait(ui.w)}})}})});ui.btnOperater.addEventListener("tap",function(){if(ui.state==2){PayOrder(ui.restoreId)}else{var a=[{title:"确认",style:"destructive"}];plus.nativeUI.actionSheet({title:"确认要删除该归还单吗?",cancel:"取消",buttons:a},function(b){if(b.index==1){ui.w=sui.wait("请稍候...");sui.post("Order/DeleteRestore",{restoreId:ui.restoreId},function(e){if(e){var d=e.IsPass;if(d){var c=plus.webview.getWebviewById("orderRecover.html");if(c){c.evalJS("beforeRefresh();")}sui.closewait(ui.w);mui.toast("归还单删除成功");plus.webview.currentWebview().close()}else{mui.toast(e.Desc);sui.closewait(ui.w)}}else{mui.toast("无法连接到服务器，请检查网络是否连接");sui.closewait(ui.w)}})}})}});function beforeRefresh(){detail();var b=plus.webview.getWebviewById("recover.html");var a=plus.webview.getWebviewById("orderRecover.html");if(b){b.evalJS("pulldownRefresh();")}if(a){a.evalJS("beforeRefresh();")}}mui(ui.container).on("tap","ul[data=wuliu]",function(){sui.open("recoverLogistics.html","recoverLogistics.html",{restoreId:ui.restoreId,RecycleCode:ui.RecycleCode})});mui(ui.container).on("tap","li[data=detail]",function(){var a=this.getAttribute("data-v");sui.open("../goods/goodsDetailMain.html","goodsDetailMain.html",{pid:a})});