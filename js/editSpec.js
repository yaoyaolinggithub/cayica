var ui={btnSure:sui.gel("btnSure"),container:sui.gel("container"),w:null,cartId:null,ProductSkuId:null,isrefresh:true,SaleType:1};var detailRefresh=function(b,a){sui.request(b,a,true,function(n){if(n){var s=n.IsPass;if(s){ui.ProductSkuId=n.ReturnObject.Prodcut.ProductSkuId;var w={CoverImage:n.ReturnObject.Prodcut.CoverImage,Deposit:n.ReturnObject.Prodcut.Deposit,Rent:n.ReturnObject.Prodcut.Rent,SaleType:n.ReturnObject.Prodcut.SaleType,AttributeList:n.ReturnObject.AttributeList,RentRuleList:n.ReturnObject.RentRuleList,unique:sui.unique(6)};ui.SaleType=n.ReturnObject.Prodcut.SaleType;var p='<span class="f-price">{%Deposit%}</span>{%rent%}';switch(w.SaleType){case 1:p=p.replace("{%Deposit%}",w.Deposit).replace("{%rent%}",'<span class="l-price">'+w.Rent+"</span>");break;case 2:p=p.replace("{%Deposit%}",w.Deposit).replace("{%rent%}","");break;case 4:p=p.replace("{%Deposit%}",w.Deposit).replace("{%rent%}","");break;default:break}var q=['<div class="pop-header"><img src="images/hand.png" class="goodspic" id="'+w.unique+'"/><div class="price">'+p,'</div></div><div class="attrbox">'];var v=w.AttributeList.length;for(var o=0;o<v;o++){q.push('<div class="h-container '+(o==0?"":"pad0")+'"><div class="pop-title"> '+w.AttributeList[o].AttrName+"</div>");var g=w.AttributeList[o].AttrValList.length;for(var l=0;l<g;l++){var u="";var c=w.AttributeList[o].AttrValList[l].IsDisable;if(c){u="disabled"}else{u=w.AttributeList[o].AttrValList[l].IsSelected==true?"active":""}q.push('<span class="mui-badge  '+u+'"  data="'+(c?"":"attr")+'" data-v="'+w.AttributeList[o].AttrValList[l].AttrValId+'">'+w.AttributeList[o].AttrValList[l].AttrValName+"</span>")}q.push("</div>")}q.push("</div>");if(w.SaleType!=2){q.push('<div class="way"> 选择押金方案</div><ul class="mui-table-view">');var r=w.RentRuleList.length;for(var h=0;h<r;h++){var t=w.RentRuleList[h].PeriodDescription;var e=w.RentRuleList[h].DetailList;var d=e.length;q.push('<li class="mui-table-view-cell"><div class="mui-radio" ><input name="radio1" type="radio" value="'+w.RentRuleList[h].RuleId+'" '+(w.RentRuleList[h].IsSelected?"checked":"")+"/>");q.push('</div><div class="rent"><span class="one">押金：'+w.RentRuleList[h].Deposit+'</span></div></li><div class="detail"><div class="row">租期</div><div class="row">租金</div>');for(var f=0;f<d;f++){q.push('<div class="row">'+e[f].RentDate+'</div><div class="row">'+e[f].RentMoney+"</div>")}q.push("</div>");if(!sui.IsNullOrEmpty(t)){q.push('<div class="desc">'+t+"</div>")}}q.push("</ul>")}ui.container.innerHTML=q.join("");ui.btnSure.classList.remove("mui-hidden");cache.setImg(w.unique,w.CoverImage);sui.closewait(ui.w)}else{mui.toast(n.Desc);sui.closewait(ui.w)}}else{mui.toast("无法连接到服务器，请检查网络是否连接");sui.closewait(ui.w)}})};(function(a){if(a.os.ios){ui.container.classList.add("ios-scroll-bounce")}a.plusReady(function(){ui.cartId=plus.webview.currentWebview().cartId;setTimeout(function(){ui.w=sui.wait("正在加载...");detailRefresh("Order/ShoppingCarProduct",{cartId:ui.cartId})},250)})})(mui);mui(ui.container).on("tap","span[data=attr]",function(){var n=this;var o=n.className;if(~o.indexOf("active")){return}else{ui.w=sui.wait("请稍候...");var f=n.parentNode.querySelectorAll("span");var d=null;var a=f.length;for(var k=0;k<a;k++){var e=f[k].className;if(~e.indexOf("active")){d=f[k]}f[k].classList.remove("active")}n.classList.add("active");var g=document.querySelector('div[class="attrbox"]').querySelectorAll(".active");var l=g.length;var c="";for(var h=0;h<l;h++){c+=g[h].getAttribute("data-v")+","}if(!sui.IsNullOrEmpty(c)){c=c.substring(0,c.length-1);sui.request("Home/ProductDetailCondition",{productSkuId:ui.ProductSkuId,condition:c},true,function(t){if(t){var u=t.IsPass;if(u){ui.ProductSkuId=t.ReturnObject.ProductSkuId;var p=t.ReturnObject.IsRefrsh;if(p){ui.isrefresh=true;ui.w=sui.wait("请稍候...");detailRefresh("Order/ShoppingCarProductInfo",{productSkuId:ui.ProductSkuId})}else{ui.isrefresh=false;var y=t.ReturnObject.AttributeList;var x=y.length;var j="";for(var v=0;v<x;v++){j+='<div class="h-container '+(v==0?"":"pad0")+'" ><div class="pop-title"> '+y[v].AttrName+"</div>";var q=y[v].AttrValList.length;for(var z=0;z<q;z++){var w="";var i=y[v].AttrValList[z].IsDisable;if(i){w="disabled"}else{w=y[v].AttrValList[z].IsSelected==true?"active":""}j+='<span class="mui-badge '+w+'" data="'+(i==true?"":"attr")+'" data-v="'+y[v].AttrValList[z].AttrValId+'">'+y[v].AttrValList[z].AttrValName+"</span>"}j+="</div>"}document.querySelector('div[class="attrbox"]').innerHTML=j;sui.closewait(ui.w)}}else{for(var r=0;r<a;r++){f[r].classList.remove("active")}if(d){d.classList.add("active")}mui.toast(t.Desc);sui.closewait(ui.w)}}else{for(var r=0;r<a;r++){f[r].classList.remove("active")}if(d){d.classList.add("active")}mui.toast("无法连接到服务器，请检查网络是否连接");sui.closewait(ui.w)}})}else{for(var b=0;b<a;b++){f[b].classList.remove("active")}if(d){d.classList.add("active")}sui.closewait(ui.w)}}});ui.btnSure.addEventListener("tap",function(){var a=ui.container.querySelectorAll('input[type="radio"]:checked').length;if(!ui.isrefresh){mui.toast("请选择规格");return}else{if(ui.SaleType!=2&&!a){mui.toast("请选择押金方案");return}}sui.wait("请稍候...");var b="00000000-0000-0000-0000-000000000000";if(ui.SaleType!=2){b=ui.container.querySelector('input[type="radio"]:checked').value}sui.post("Order/ModifyShoppingCar",{cartId:ui.cartId,productSkuId:ui.ProductSkuId,ruleId:b},function(d){if(d){var c=d.IsPass;if(c){var e=plus.webview.getWebviewById("cart.html");mui.fire(e,"shoppingcart");setTimeout(function(){plus.webview.currentWebview().close()},200);sui.closewait(ui.w)}else{mui.toast(d.Desc);sui.closewait(ui.w)}}else{mui.toast("无法连接到服务器，请检查网络是否连接");sui.closewait(ui.w)}})});