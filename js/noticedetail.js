var ui={w:null,container:sui.gel("container"),shares:{},title:"",newsId:""};(function(a){if(a.os.ios){document.getElementById("safari").classList.remove("mui-hidden")}a.init({gestureConfig:{longtap:true}});a.plusReady(function(){ui.newsId=plus.webview.currentWebview().newsId;setTimeout(function(){ui.w=sui.wait("正在加载...");sui.request("Home/NewsDetail",{newId:ui.newsId},true,function(d){if(d){var c=d.IsPass;if(c){ui.title=d.ReturnObject.Name;var b=d.ReturnObject.NewsContent;ui.container.innerHTML='<div class="title mui-table-view">'+ui.title+'</div><div class="time">'+d.ReturnObject.InsertTime+'</div><div class="content">'+b+"</div>";sui.closewait(ui.w)}else{mui.toast(d.Desc);sui.closewait(ui.w)}}else{mui.toast("无法连接到服务器，请检查网络是否连接！");sui.closewait(ui.w)}});plus.share.getServices(function(d){if(d&&d.length>0){for(var c=0;c<d.length;c++){var b=d[c];ui.shares[b.id]=b}}},function(){a.toast("获取分享服务列表失败")})},250)})})(mui);var shareMessage=function(d,c,b){var h={extra:{scene:c}};var f=sui.shared()+"#/doc/content?source=2&newId="+ui.newsId;h.href=f;var a="擦哥头条";var g=ui.title;var e=document.querySelector(".content").innerText;g=g.length>25?g.substring(0,25)+"...":g;e=e.length>30?e.substring(0,30)+"...":e;if(b==3){e=e+f}if(!sui.IsNullOrEmpty(e)){a=e}if(!sui.IsNullOrEmpty(g)){a=g}h.title=a;h.content=e==""?"来自擦一擦的分享："+f:e;h.thumbs=["_www/images/appicon.png"];h.pictures=["_www/images/appicon.png"];d.send(h,function(){},function(i){})};var shareAction=function(d,b,a){var c=null;if(!d||!(c=ui.shares[d])){mui.toast("无效的分享服务！");return}if(c.authenticated){shareMessage(c,b,a)}else{c.authorize(function(){shareMessage(c,b,a)},function(f){})}};function copyVal(f){if(plus.os.name=="Android"){var c=plus.android.importClass("android.content.Context");var a=plus.android.runtimeMainActivity();var d=a.getSystemService(c.CLIPBOARD_SERVICE);plus.android.invoke(d,"setText",f)}else{var b=plus.ios.importClass("UIPasteboard");var e=b.generalPasteboard();e.setValueforPasteboardType(f,"public.utf8-plain-text")}mui.toast("已复制到剪贴板")}mui("body").on("tap","a[class=share_li]",function(){var e=this;var b=parseInt(e.getAttribute("sid"));var d=sui.shared()+"#/doc/content?source=2&newId="+ui.newsId;var a=ui.title+"(分享自@擦一擦)。 "+d;if(b==4){var f=plus.messaging.createMessage(plus.messaging.TYPE_SMS);f.body=a;plus.messaging.sendMessage(f)}else{if(b==5){var f=plus.messaging.createMessage(plus.messaging.TYPE_EMAIL);f.body=a;plus.messaging.sendMessage(f)}else{if(b==6){plus.runtime.openURL(d)}else{if(b==7){copyVal(d)}else{var c=[{id:"weixin",ex:"WXSceneSession"},{id:"weixin",ex:"WXSceneTimeline"},{id:"qq"},{id:"sinaweibo"}];shareAction(c[b].id,c[b].ex,b)}}}}mui("#Share").popover("toggle")});function toggle(){mui("#Share").popover("toggle")}mui(ui.container).on("tap","a",function(){var a=this.getAttribute("href");if(a){plus.runtime.openURL(a)}});mui(ui.container).on("longtap","a",function(){var a=this.getAttribute("href");if(a){copyVal(a)}});