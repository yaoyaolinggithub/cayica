var ui={orderInfo:sui.gel("orderInfo"),w:null,PayWaterId:null,container:sui.gel("container"),pays:{},isWeChat:false,isAlipay:false,payType:1,isYuDin:false};var getOrderPay=function(b,c){ui.w=sui.wait("请稍候...");var a={PayWaterId:ui.PayWaterId,Amount:10000,PayTitle:"",IsNeedPay:true,Channel:b,PayParam:""};sui.request("Order/Pay",a,false,function(f){if(f){var e=f.IsPass;if(e){sui.closewait(ui.w);if(b==1){}else{var d=f.ReturnObject.PayParam;plus.payment.request(ui.pays[c],d,function(g){plus.nativeUI.alert("您已付款成功",function(){sui.open("paySuccess.html","paySuccess.html",{payType:ui.payType,isYuDin:ui.isYuDin});var i=plus.webview.currentWebview().opener();if(!i||i.id=="applyRecover.html"||i.id=="subOrder.html"){var h={recover:plus.webview.getWebviewById("recover.html"),orderRecover:plus.webview.getWebviewById("orderRecover.html"),cart:plus.webview.getWebviewById("cart.html"),repay:plus.webview.getWebviewById("repaymentSub.html")};if(h.recover){h.recover.evalJS("pulldownRefresh();")}if(h.orderRecover){h.orderRecover.evalJS("beforeRefresh();")}if(h.repay){h.repay.evalJS("beforeRefresh();")}h.cart.evalJS("pulldownRefresh();")}else{i.evalJS("beforeRefresh();")}setTimeout(function(){var j=plus.webview.currentWebview();j.close("none",0)},500)},"支付成功")},function(g){plus.nativeUI.alert("支付失败: ["+g.code+"]",function(){sui.open("payFail.html","payFail.html",{payType:ui.payType})},"支付失败")})}}else{mui.toast(f.Desc);sui.closewait(ui.w)}}else{mui.toast("无法连接到服务器，请检查网络是否连接");sui.closewait(ui.w)}})};function checkServices(b){if(!b.serviceReady){var a=null;switch(b.id){case"alipay":a="检测到系统未安装“支付宝快捷支付服务”，无法完成支付操作，是否立即安装？";break;default:a="系统未安装“"+b.description+"”服务，无法完成支付，是否立即安装？";break}plus.nativeUI.confirm(a,function(c){if(c.index==0){b.installService()}},b.description)}else{if(b.id=="alipay"){ui.isAlipay=true}if(b.id=="wxpay"){ui.isWeChat=true}}}(function(a){a.plusReady(function(){a.init({beforeback:function(){var f=plus.webview.currentWebview().opener();if(!f||f.id=="applyRecover.html"||f.id=="subOrder.html"){var e={recover:plus.webview.getWebviewById("recover.html"),orderRecover:plus.webview.getWebviewById("orderRecover.html"),cart:plus.webview.getWebviewById("cart.html"),repay:plus.webview.getWebviewById("repaymentSub.html")};if(e.recover){e.recover.evalJS("pulldownRefresh();")}if(e.orderRecover){e.orderRecover.evalJS("beforeRefresh();")}if(e.repay){e.repay.evalJS("beforeRefresh();")}e.cart.evalJS("pulldownRefresh();")}else{f.evalJS("beforeRefresh();")}}});plus.payment.getChannels(function(e){for(var f in e){var g=e[f];ui.pays[g.id]=g;checkServices(g)}},function(f){a.toast("获取支付通道失败："+f.message)});var c=plus.webview.currentWebview();ui.PayWaterId=c.PayWaterId;ui.payType=c.payType;var b=c.Amount;var d=c.PayTitle;if(~d.indexOf("定金")){ui.isYuDin=true}setTimeout(function(){ui.orderInfo.innerHTML=d+'<span class="mui-badge">¥'+sui.rmoney(b)+"</span>"},250);mui(ui.container).on("tap","li[data=pay]",function(){var e=this.getAttribute("data-v");var f="alipay";if(e=="onePay"){getOrderPay(1)}else{if(e=="weChat"){if(!ui.isWeChat){mui.toast("暂不支持此支付通道");return}f="wxpay";getOrderPay(2,f)}else{if(!ui.isAlipay){mui.toast("暂不支持此支付通道");return}getOrderPay(3,f)}}})})})(mui);