var ui={txtMobile:sui.gel("txtMobile"),txtYzm:sui.gel("txtYzm"),txtPwd:sui.gel("txtPwd"),btnSend:sui.gel("btnSend"),btnSure:sui.gel("btnSure"),w:null,isSend:0,channel:2};(function(a){a.plusReady(function(){ui.channel=plus.os.name=="Android"?2:3;ui.btnSend.addEventListener("tap",function(){var e=ui.txtMobile.value.trim();if(sui.IsNullOrEmpty(e)){a.toast("请输入手机号！");return}else{if(!e.isMobile()){a.toast("请输入正确的手机号码！");return}}ui.isSend=0;ui.btnSend.innerText="请稍候...";ui.btnSend.setAttribute("disabled","disabled");sui.request("Passport/GetTime",{},true,function(g){if(g){var f=g.IsPass;if(f){b(g.ReturnObject,e)}else{a.toast("获取验证码失败,请稍候再试！");ui.btnSend.removeAttribute("disabled");ui.btnSend.innerText="获取验证码"}}else{a.toast("获取验证码失败，请检查网络是否连接！");ui.btnSend.removeAttribute("disabled");ui.btnSend.innerText="获取验证码"}})});var d=function(f){if(f!=null){var g,e;e=/\d*/i;g=f.match(e);return(g==f)?true:false}return false};var c=function(l){hash=hex_md5(l);var f="000000";var g=0;for(var k=hash.length;k>0;k--){var h=0;var e=hash.substring(k-1,k);if(d(e)){g++;if(g==7){break}var h=9-parseInt(e);f=f+h.toString()}}f=f.substring(f.length-6,f.length);return f};var b=function(f,g){f=c(f)+f;var e={Mobile:g,ImageCode:f,Channel:ui.channel,BussinessType:3};sui.request("Passport/GetPhoneCode",e,false,function(k){if(k){var j=k.IsPass;if(j){ui.isSend=1;ui.txtMobile.setAttribute("disabled","disabled");var i=180;function h(){if(i>=0){ui.btnSend.innerText=i+"s";--i}else{clearInterval(InTime);ui.btnSend.innerText="获取验证码";ui.btnSend.removeAttribute("disabled")}}InTime=setInterval(h,1000)}else{ui.btnSend.innerText="获取验证码";ui.btnSend.removeAttribute("disabled");a.toast(k.Desc)}}else{ui.btnSend.removeAttribute("disabled");ui.btnSend.innerText="获取验证码";a.toast("发送失败,请检查网络是否连接！")}})};ui.btnSure.addEventListener("tap",function(){var g=ui.txtMobile.value.trim();var h=ui.txtPwd.value.trim();var f=ui.txtYzm.value.trim();if(!ui.isSend){mui.toast("请获取手机验证码！");return}else{if(sui.IsNullOrEmpty(g)){a.toast("请输入手机号！");return}else{if(!g.isMobile()){a.toast("请输入正确的手机号！");return}else{if(sui.IsNullOrEmpty(f)){a.toast("请输入验证码！");return}else{if(sui.IsNullOrEmpty(h)){a.toast("请输入新密码！");return}}}}}ui.w=sui.wait("正在提交...");var e={Mobile:g,Password:h,Code:f};sui.request("Passport/Forget",e,false,function(j){if(j){var i=j.IsPass;if(i){sui.closewait(ui.w);a.toast("新密码设置成功");plus.webview.currentWebview().close()}else{sui.closewait(ui.w);a.toast(j.Desc);ui.txtMobile.removeAttribute("disabled")}}else{sui.closewait(ui.w);a.toast("提交失败，请检查网络是否连接！");ui.txtMobile.removeAttribute("disabled")}})})})})(mui);